/*! For license information please see 9295.js.LICENSE.txt */
(self.webpackChunkConnect=self.webpackChunkConnect||[]).push([[9295],{19295:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>g});var r=n(9367),i=n(19194),o=n.n(i),a=(n(3463),n(11082)),s=n.n(a),c=(n(89306),n(33846));function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function u(){u=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof f?t:f,o=Object.create(i.prototype),a=new k(r||[]);return o._invoke=function(e,t,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return E()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===p)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=l(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(e,n,a),o}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var p={};function f(){}function m(){}function v(){}var h={};s(h,i,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(P([])));y&&y!==t&&n.call(y,i)&&(h=y);var C=v.prototype=f.prototype=Object.create(h);function S(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(i,o,a,s){var c=l(e[i],e,o);if("throw"!==c.type){var u=c.arg,p=u.value;return p&&"object"==d(p)&&n.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,a,s)}),(function(e){r("throw",e,a,s)})):t.resolve(p).then((function(e){u.value=e,a(u)}),(function(e){return r("throw",e,a,s)}))}s(c.arg)}var i;this._invoke=function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}}function T(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,T(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function P(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:E}}function E(){return{value:void 0,done:!0}}return m.prototype=v,s(C,"constructor",v),s(v,"constructor",m),m.displayName=s(v,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,s(e,a,"GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},S(b.prototype),s(b.prototype,o,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new b(c(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(C),s(C,a,"Generator"),s(C,i,(function(){return this})),s(C,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:P(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t,n,r,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function v(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function a(e){m(o,r,i,a,s,"next",e)}function s(e){m(o,r,i,a,s,"throw",e)}a(void 0)}))}}var h=document.createElement("script");function g(){var e=window.atob("aHR0cHM6Ly9zaWduYWx2Mi5rb2RlbWludC5pbjo5MDAyLw=="),t=null,n=!1,r={},i={debug:!1,iceServers:[],mediaServers:[],signalServer:e,opaqueId:"KMConnect",maxParticipants:1e3},a={},s={},d={},l={},f={},m=new c.Z,h=null;function g(){return g=v(u().mark((function e(){var n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=r.length>0&&void 0!==r[0]?r[0]:{}).config){e.next=4;break}throw"RTC Library config not defined!";case 4:return i=Object.assign(i,n.config),n.callbacks&&(a=Object.assign(a,n.callbacks)),m.setDebug(i.debug),m.log("RTCMC - init called",n),!t&&n.options&&b(p({},n.options)),e.abrupt("return",{getInstance:y,getUserInfo:C,getInstanceUserId:S,initSession:b,setupFileSharing:T,startMeeting:w,joinMeeting:R,leaveMeeting:k,publishFeed:N,updatePublishedFeed:j,removeFeed:F,sendMessage:P,acceptJoiningRequest:E,roomExists:I,close:B,shareFile:G,getAllStreams:V});case 10:case"end":return e.stop()}}),e)}))),g.apply(this,arguments)}function y(){return t}function C(){var e;return null===(e=t.extra)||void 0===e?void 0:e.user}function S(){return t.userid}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=M(e);m.log("RTCMC - initSession called",t),D(t)}function T(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.callbacks&&(a=Object.assign(a,e.callbacks)),t.enableFileSharing=!0,t.chunkSize=15e3,t.onFileStart=fe,t.onFileProgress=me,t.onFileEnd=ve}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=M(e);m.log("RTCMC - startMeeting called",n);var r=function(){t.enableScalableBroadcast?(t.userid=n.room,t.connectSocket((function(e){m.log("RTCMC - startMeeting socket join-broadcast"),e.emit("join-broadcast",{broadcastId:n.room,userid:t.userid,typeOfStreams:t.session})}))):(m.log("RTCMC - startMeeting createRoom"),L(n))};t?r():(n.success=function(){r()},D(n))}function R(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=M(e);m.log("RTCMC - joinMeeting called",n);var r=function(){t.enableScalableBroadcast?t.connectSocket((function(e){e.emit("join-broadcast",{broadcastId:n.room,userid:t.userid,typeOfStreams:t.session})})):U(n)};t?r():(n.success=function(){r()},D(n))}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - leaveMeeting called",e);var n=t.userid;B(p(p({},e),{},{callback:function(){x("leftMeeting"),P({event:"leftMeeting",data:{userId:n}})}}))}function P(e){var n=e.event,r=e.type,i=e.data,o=void 0===i?{}:i,a=e.timeout,s=void 0===a?0:a,c=e.callback;if(t)if(n&&t.socket)try{setTimeout((function(){t.socket.emit("Whisper",{event:n,data:o}),c&&_.isFunction(c)&&c()}),s)}catch(e){}else try{setTimeout((function(){t.send({type:r,data:o}),c&&_.isFunction(c)&&c()}),s)}catch(e){}}function E(e){var n=e.participantId,r=e.userId,i=e.userPreferences;t.acceptParticipationRequest(n,i),l[r]=!0,q()}function x(e,t){m.debug("Got a eventCallback",e),m.debug("Got a eventCallback - data",t),e&&a.hasOwnProperty(e)&&_.isFunction(a[e])&&a[e](t)}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=p({},e);return _.isObject(t.user)&&(t.userObject=p({},t.user),t.user=JSON.stringify(t.user)),t.user,t.config=Object.assign({},i,t.config),s=t.meeting?t.meeting:s,d=t.meetingConfigs?t.meetingConfigs:d,t}function O(e){return A.apply(this,arguments)}function A(){return(A=v(u().mark((function e(n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getSocket((function(e){if(e)return e;throw"RTCMC - Socket not found!"}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(){var n,r,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - createSession called",i),t||(t=new(o()),window.rtcmc=t,t.socketURL=i.config.signalServer||e,m.log("RTCMC - socketURL",t.socketURL),t.iceServers=i.config.iceServers,t.autoCreateMediaElement=!1,t.enableLogs=i.config.debug,i.config.forceTurn&&(t.candidates={turn:!0,stun:!1,host:!1}),t.onopen=ie,t.onmessage=oe,t.onNewParticipant=ae,t.onNumberOfBroadcastViewersUpdated=se,t.onstream=ce,t.onstreamended=de,t.onMediaError=ue,t.onerror=le,t.onUserIdAlreadyTaken=pe,t.setCustomSocketEvent("Whisper"),l={},f={},t.maxParticipantsAllowed=i.config.maxParticipants,t.mediaConstraints={video:!1,audio:!1,screen:!1},t.dontCaptureUserMedia=!0,i.meetingRules&&(t.session=i.meetingRules.session,t.sdpConstraints.mandatory={OfferToReceiveAudio:i.meetingRules.receiveAudio,OfferToReceiveVideo:i.meetingRules.receiveVideo},i.meetingRules.session.oneway&&(t.enableScalableBroadcast=!0,t.autoCloseEntireSession=!0,t.maxRelayLimitPerUser=1,t.socketMessageEvent="scalable-media-broadcast-demo",t.connectSocket((function(e){e.on("join-broadcaster",(function(e){m.log("RTCMC - socket join-broadcaster",e),t.session=e.typeOfStreams,t.sdpConstraints.mandatory={OfferToReceiveVideo:!!t.session.video,OfferToReceiveAudio:!!t.session.audio},t.broadcastId=e.broadcastId,U({room:e.userid,force:!0})})),e.on("rejoin-broadcast",(function(n){m.log("RTCMC - socket rejoin-broadcast",n),t.attachStreams=[],e.emit("check-broadcast-presence",n,(function(r){m.log("RTCMC - socket check-broadcast-presence",n,r),r?(m.log("RTCMC - socket rejoin-broadcast - emitting join-broadcast to join broadcasting"),e.emit("join-broadcast",{broadcastId:n,userid:t.userid,typeOfStreams:t.session})):i.meeting.canModerate?(t.userid=n,m.log("RTCMC - socket rejoin-broadcast - emitting join-broadcast to start broadcasting"),e.emit("join-broadcast",{broadcastId:n,userid:t.userid,typeOfStreams:t.session})):x("roomNotFound")}))})),e.on("broadcast-stopped",(function(e){m.log("RTCMC - socket broadcast-stopped",e),x("broadcastStopped",e)})),e.on("start-broadcasting",(function(e){m.log("RTCMC - socket start-broadcasting",e),s.canModerate?(t.sdpConstraints.mandatory={OfferToReceiveVideo:!1,OfferToReceiveAudio:!1},t.session=e,m.log("RTCMC - socket start-broadcasting room",t.userid),L({room:t.userid,force:!0})):x("roomNotFound")}))})))),i.userObject||(i.userObject=p({},i.user),i.user=JSON.stringify(i.user)),t.extra={user:{username:i.userObject.username,uuid:i.userObject.uuid,name:i.userObject.name,avatar:null===(n=i.userObject.profile)||void 0===n?void 0:n.avatar,cover:null===(r=i.userObject.profile)||void 0===r?void 0:r.cover},isInitiator:!1,isHost:i.meeting.isHost,canModerate:i.meeting.canModerate,canToggleAudio:i.meetingConfigs.canToggleAudio,canToggleVideo:i.meetingConfigs.canToggleVideo,broadcastId:i.room,streamsInfo:{}},x("sessionCreated"),q(),_.isFunction(i.success)&&(m.log("RTCMC - Success callback after creating session"),i.success()))}function I(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t?(m.log("RTCMC - roomExists called",e),t.enableScalableBroadcast?O().then((function(t){t.emit("check-broadcast-presence",e.room,(function(n){!0===n?(m.log("RTCMC - broadcast room Exists yes"),_.isFunction(e.yes)&&e.yes(t)):(m.log("RTCMC - broadcast room Exists no"),_.isFunction(e.no)&&e.no(t))}))})).catch((function(t){m.error(t),_.isFunction(e.no)&&e.no(t)})):t.checkPresence(e.room,(function(t,n){!0===t?(m.log("RTCMC - room Exists yes"),_.isFunction(e.yes)&&e.yes()):(m.log("RTCMC - room Exists no"),_.isFunction(e.no)&&e.no())}))):_.isFunction(e.no)&&e.no()}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - createRoom called",e);var r=function(){n||(t.extra.isInitiator=!0,t.open(e.room,(function(e,t,r){n=!1,r?x("createRoomError",r):!0===e&&(n=!0,t,x("roomCreated",t),z())})))};e.force?r():I({room:e.room,no:function(e){r()},yes:function(){U(p(p({},e),{},{force:!0}))}})}function U(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - joinRoom called",e);var r=function(){n||t.join(e.room,(function(e,t,r){n=!1,!1===e||r?x("Room full"===r?"roomFullError":"joinRoomError",r):(n=!0,x("roomJoined",t),q(),z())}))};e.force?r():I({room:e.room,no:function(){x("roomNotFound")},yes:function(e){r()}})}function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(m.log("RTCMC - publishFeed called",e),e.stream){var n=p({},e);if(n.info){if(t.extra.streamsInfo[n.stream.id]=n.info,t.updateExtraData(),r["".concat(n.info.from)]={info:n.info,streamId:n.stream.id,stream:n.stream},window.setTimeout((function(){t.addStream(n.stream)}),500),"cam"===n.info.from){var i=n.stream.getAudioTracks();i.length&&W(n)}}else t.addStream(n.stream)}}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - updatePublishedFeed called",e);var n=p({},e),i=null;n.info&&(i=r["".concat(n.info.from)])&&(i.stream&&(n.existingStream=t.attachStreams.find((function(e){return e.id===i.stream.id}))),t.extra.streamsInfo[i.streamId].mirroredVideo=n.info.mirroredVideo,t.updateExtraData(),r["".concat(n.info.from)].info.mirroredVideo=n.info.mirroredVideo);var o=n.existingStream;if(n.stream)if(o){n.info&&"cam"===n.info.from&&h&&h.stop();var a=n.stream.getAudioTracks(),s=n.stream.getVideoTracks();if(a.length){if(i&&"cam"===n.info.from){var c=i.stream.getAudioTracks();if(!c.length)return P({event:"streamTrackRemoved",data:{id:i.streamId}}),F(i.streamId),i.stream.getTracks().forEach((function(e){e.stop()})),void N(n)}try{t.replaceTrack(a[0],null,!1)}catch(e){m.error("Error while replacing track: ",e)}P({event:"streamTrackUpdated",data:{id:o.id,kind:"audio",info:n.info}}),n.info&&"cam"===n.info.from&&W(n)}else o.getAudioTracks().forEach((function(e){e.enabled=!1,e.stop()})),P({event:"streamTrackRemoved",data:{id:o.id,kind:"audio"},timeout:o.paused?2e3:0}),o.paused=!1;if(s.length){try{t.replaceTrack(s[0],null,!0)}catch(e){m.error("Error while replacing track: ",e)}P({event:"streamTrackUpdated",data:{id:o.id,kind:"video",info:n.info}})}else o.getVideoTracks().forEach((function(e){e.enabled=!1,e.stop()})),P({event:"streamTrackRemoved",data:{id:o.id,kind:"video"},timeout:o.paused?2e3:0}),o.paused=!1}else N(n);else n.info&&"cam"===n.info.from&&h&&h.stop(),o&&(o.getTracks().forEach((function(e){e.enabled=!1})),"remove"===n.action?P({event:"streamTrackRemoved",data:{id:o.id}}):P({event:"streamPaused",data:{id:o.id}}),o.paused=!0)}function F(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - removeFeed called",e),e.id&&t.removeStream(e.id)}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m.log("RTCMC - close called",e),t&&(t.getAllParticipants().forEach((function(e){t.disconnectWith(e)})),e.feeds&&e.feeds.length&&e.feeds.forEach((function(e){"function"==typeof e.stopFn?e.stopFn(e.stream):"function"==typeof e.stream.getTracks?e.stream.getTracks().forEach((function(e){return e.stop()})):"function"==typeof e.stream.stop&&e.stream.stop()}))),window.setTimeout((function(){t&&(t.leave(),t.closeSocket()),t=null,n=!1,l={},f={},"function"==typeof e.callback&&e.callback()}),500)}function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.file&&e.sendTo&&t.shareFile(e.file,e.sendTo)}function V(){return t.streamEvents.selectAll()}function W(e){e.stream,e.info}function z(){if(t){var e={streamTrackRemoved:H,streamTrackUpdated:Y,streamPaused:J,remoteHandToggled:K,speaking:X,stoppedSpeaking:$,snapshotTaken:Q,meetingUpdated:Z,meetingEnded:ee,userBanned:te,leftMeeting:ne,toggleRemoteAV:re};O().then((function(t){t.on("Whisper",(function(t){m.log("RTCMC - Got Socket Whisper!",t),t&&e.hasOwnProperty(t.event)&&(m.log("RTCMC - Got Socket Whisper Event: ",t.event,t.data),e[t.event](t.data))}))})).catch((function(e){m.error(e)}))}}function q(){var e=t.getAllParticipants();return m.log("RTCMC - checkNumberOfParticipants - participants length",e.length),x("participantsCountChecked",e.length),e.length}function H(e){m.log("RTCMC - On onStreamTrackRemoved: ",e),x("streamRemoved",{id:e.id,kind:e.kind})}function Y(e){m.log("RTCMC - On onStreamTrackUpdated: ",e),x("streamUpdated",{id:e.id,kind:e.kind,info:e.info})}function J(e){m.log("RTCMC - On onStreamPaused: ",e),x("streamUpdated",{id:e.id,type:"paused"})}function K(e){m.log("RTCMC - On onRemoteHandToggled: ",e),x("remoteHandToggled",e)}function X(e){x("streamUpdated",{userId:e.userId,from:e.from,type:"meta-updated",data:{key:"isTalking",value:!0}})}function $(e){x("streamUpdated",{userId:e.userId,from:e.from,type:"meta-updated",data:{key:"isTalking",value:!1}})}function Q(e){m.log("RTCMC - On onSnapshotTaken: ",e),x("snapshotTaken",e)}function Z(e){m.log("RTCMC - On onMeetingUpdated: ",e),x("meetingUpdated",e)}function ee(e){m.log("RTCMC - On onMeetingEnded: ",e),x("meetingEnded",e)}function te(e){m.log("RTCMC - On onUserBanned: ",e),x("userBanned",e)}function ne(e){m.log("RTCMC - On onLeftMeeting: ",e),x("feedRemoved",{id:null,userId:e.userId})}function re(e){m.log("RTCMC - On onToggleRemoteAV: ",e),e.userId&&e.userId===t.userid||x("toggleRemoteAV",e)}function ie(e){m.log("RTCMC - On rtcmOnOpen: ",e),f[e.userid]||(f[e.userid]=!0,x("dataChannelOpened",e))}function oe(e){var t=e.data,n=e.extra,r=e.userid;m.log("RTCMC - On rtcmOnMessage: ",t,n,r),t&&("whiteboard"!==t.type?"file-sharing"!==t.type?x("messageReceived",{userId:r,user:null==n?void 0:n.user,data:t.data}):x("fileSharingMessageReceived",{userId:r,user:null==n?void 0:n.user,data:t.data}):x("whiteboardMessageReceived",{userId:r,user:null==n?void 0:n.user,data:t.data}))}function ae(e,n){if(m.log("RTCMC - On rtcmOnNewParticipant - participantId, userPreferences: ",e,n),!(q()>=t.maxParticipantsAllowed)){var r=n.connectionDescription.remoteUserId;if(!d.askHostBeforeJoining||l[r])return t.acceptParticipationRequest(e,n),l[r]=!0,void q();x("joiningRequest",{participantId:e,userId:r,userPreferences:n})}}function se(e){m.log("RTCMC - On onNumberOfBroadcastViewersUpdated: ",e),!t.isInitiator&&t.extra.isHost||x("numberOfBroadcastViewersUpdated",e.numberOfBroadcastViewers)}function ce(e){if(m.log("RTCMC - On rtcmOnStream: ",e),q(),t.peers[e.userid]){var n=p({},e.extra),r=e.id||e.streamid,i=n.streamsInfo[r]||{};if("live_class"!==s.type.uuid||t.isInitiator||t.extra.isHost||n.isInitiator||n.isHost||"remote"!==e.type){if(!("webinar"!==s.type.uuid&&"podcast"!==s.type.uuid||t.isInitiator||t.extra.isHost||n.isInitiator||n.isHost||"remote"!==e.type))if(t.enableScalableBroadcast){if(n.broadcasterExtra){var o=p({},n.broadcasterExtra);delete n.broadcasterExtra,n=p(p({},n),o)}}else if(!e.extra.isInitiator&&!e.extra.isHost)return void m.log("RTCMC - On rtcmOnStream - Incoming stream is not from host! Dont show!");if(t.enableScalableBroadcast){if((t.isInitiator||t.extra.isHost)&&"remote"===e.type)return;t.isUpperUserLeft=!1,(e.extra.isInitiator||e.extra.isHost)&&(t.extra.broadcasterExtra=p({},n),t.updateExtraData())}var a=p({id:r,userId:e.userid,stream:e.stream,mirroredVideo:i.mirroredVideo||!1},n);i.from&&(a.isScreen="screen"===i.from,a.isWhiteboard="whiteboard"===i.from,a.isTalking="cam"===i.from&&i.talking),x("streamAdded",a),!t.enableScalableBroadcast||t.isInitiator||t.isHost||"remote"!==e.type||(t.dontCaptureUserMedia=!0,t.attachStreams=[e.stream],t.sdpConstraints.mandatory={OfferToReceiveAudio:!1,OfferToReceiveVideo:!1},t.getSocket((function(n){"Chrome"===t.DetectRTC.browser.name&&t.getAllParticipants().forEach((function(n){if(n+""!=e.userid+""){var r=t.peers[n].peer;r.getLocalStreams().forEach((function(e){r.removeStream(e)})),e.stream.getTracks().forEach((function(t){r.addTrack(t,e.stream)})),t.dontAttachStream=!0,t.renegotiate(n),t.dontAttachStream=!1}})),"Firefox"===t.DetectRTC.browser.name&&t.getAllParticipants().forEach((function(n){n+""!=e.userid+""&&t.replaceTrack(e.stream,n)})),t.DetectRTC.browser.name})))}else m.log("RTCMC - On rtcmOnStream - Incoming stream is not from host! Dont show!")}else m.log("RTCMC - On rtcmOnStream - participant already gone!")}function de(e){m.log("RTCMC - On rtcmOnStreamEnded: ",e);var t=p({},e.extra),n=e.id||e.streamid,r=t.streamsInfo[n]||{},i=p({id:n,userId:e.userid,stream:e.stream,mirroredVideo:r.mirroredVideo||!1},e.extra);r.from&&(i.isScreen="screen"===r.from,i.isWhiteboard="whiteboard"===r.from,i.isTalking="cam"===r.from&&r.talking),x("streamRemoved",i)}function ue(e){m.log("RTCMC - On rtcmOnMediaError: ",e)}function le(e){m.log("RTCMC - On rtcmOnError: ",e),e.userid&&x("feedRemoved",{id:null,userId:e.userid})}function pe(e,n){t.userid=n}function fe(e){x("fileReceivingStart",{file:e})}function me(e){x("fileReceivingProgress",{chunk:e})}function ve(e){x("fileReceivingEnd",{file:e})}return m.log("RTC Library RTCMC Loaded!"),window.rtcmc=t,{init:function(){return g.apply(this,arguments)}}}h.setAttribute("src","/js/EBML.js"),document.head.appendChild(h),window.io=r.ZP,window.hark=s()},3463:(e,t)=>{var n,r,i,o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}o=function(){return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,(function(e){return i(t[a][1][e]||e)}),d,d.exports,e,t,n,r)}return n[a].exports}for(var o=void 0,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";var r=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=r},{"./adapter_factory.js":2}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.adapterFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},d=r.log,u=r.detectBrowser(t),l={browserDetails:u,commonShim:c,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!n.shimChrome)return d("Chrome shim is not included in this adapter release."),l;if(null===u.version)return d("Chrome shim can not determine version, not shimming."),l;d("adapter.js shimming chrome."),l.browserShim=i,i.shimGetUserMedia(t),i.shimMediaStream(t),i.shimPeerConnection(t),i.shimOnTrack(t),i.shimAddTrackRemoveTrack(t),i.shimGetSendersWithDtmf(t),i.shimGetStats(t),i.shimSenderReceiverGetStats(t),i.fixNegotiationNeeded(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;case"firefox":if(!a||!a.shimPeerConnection||!n.shimFirefox)return d("Firefox shim is not included in this adapter release."),l;d("adapter.js shimming firefox."),l.browserShim=a,a.shimGetUserMedia(t),a.shimPeerConnection(t),a.shimOnTrack(t),a.shimRemoveStream(t),a.shimSenderGetStats(t),a.shimReceiverGetStats(t),a.shimRTCDataChannel(t),a.shimAddTransceiver(t),a.shimGetParameters(t),a.shimCreateOffer(t),a.shimCreateAnswer(t),c.shimRTCIceCandidate(t),c.shimConnectionState(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"edge":if(!o||!o.shimPeerConnection||!n.shimEdge)return d("MS edge shim is not included in this adapter release."),l;d("adapter.js shimming edge."),l.browserShim=o,o.shimGetUserMedia(t),o.shimGetDisplayMedia(t),o.shimPeerConnection(t),o.shimReplaceTrack(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t);break;case"safari":if(!s||!n.shimSafari)return d("Safari shim is not included in this adapter release."),l;d("adapter.js shimming safari."),l.browserShim=s,s.shimRTCIceServerUrls(t),s.shimCreateOfferLegacy(t),s.shimCallbacksAPI(t),s.shimLocalStreamsAPI(t),s.shimRemoteStreamsAPI(t),s.shimTrackEventTransceiver(t),s.shimGetUserMedia(t),s.shimAudioContext(t),c.shimRTCIceCandidate(t),c.shimMaxMessageSize(t),c.shimSendThrowTypeError(t),c.removeAllowExtmapMixed(t);break;default:d("Unsupported browser!")}return l};var r=d(e("./utils")),i=d(e("./chrome/chrome_shim")),o=d(e("./edge/edge_shim")),a=d(e("./firefox/firefox_shim")),s=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},n.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.track.id})):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})),t.stream.getTracks().forEach((function(r){var i=void 0;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track&&e.track.id===r.id})):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else s.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},n.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){var i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){n._senders.push(t(n,e))}))};var a=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},n.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,n=Array.prototype.slice.call(arguments),r=n[0],i=n[1],o=n[2];if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){i(s(a(e)))};return t.apply(this,[c,r])}return new Promise((function(n,r){t.apply(e,[function(e){n(s(a(e)))},r])})).then(i,o)}}},n.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return s.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],n=void 0,r=void 0,i=void 0;return this.getSenders().forEach((function(e){e.track===t&&(n?i=!0:n=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(r?i=!0:r=e),e.track===t})),i||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},n.shimAddTrackRemoveTrackWithNative=d,n.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=s.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return d(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(n.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find((function(e){return e.track===t}));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[n.id];if(a)a.addTrack(t),Promise.resolve().then((function(){r.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[n.id]=s,this._reverseStreams[s.id]=n,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=c({},t,(function(){var e=this,t=arguments,r=arguments.length&&"function"==typeof arguments[0];return r?n.apply(this,[function(n){var r=u(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((function(t){return u(e,t)}))}));e.RTCPeerConnection.prototype[t]=r[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=l(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:u(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach((function(r){t._streams[r].getTracks().find((function(t){return e.track===t}))&&(n=t._streams[r])})),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function u(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function l(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}},n.shimPeerConnection=function(e){var t=s.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){var n=0===e.RTCPeerConnection.prototype.addIceCandidate.length;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t],r=c({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=r[t]}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return n||arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},n.fixNegotiationNeeded=function(e){var t=s.detectBrowser(e);s.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js"));function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var r=this.getSenders();n.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===r.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]})),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((function(t){var r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)};n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var n=i.detectBrowser(e),a=function(e){if("object"!==(void 0===e?"undefined":r(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal,t.optional.push(a)):(a[o("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,i){if(n.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===r(e.audio)){var s=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};s((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),s(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===r(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":r(c))?c:{ideal:c});var d=n.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var u=void 0;if("environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return t.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!n&&t.length&&u.includes("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=a(e.video),o("chrome: "+JSON.stringify(e)),i(e)}))}e.video=a(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return n.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,n,r){s(e,(function(e){t.webkitGetUserMedia(e,n,(function(e){r&&r(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var d=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return s(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils.js")),o=i.log},{"../utils.js":15}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)};n.shimRTCIceCandidate=function(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new t(e),i=s.default.parseCandidate(e.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,c.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},n.shimMaxMessageSize=function(e){if(e.RTCPeerConnection){var t=c.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=function(e){if(!e||!e.sdp)return!1;var t=s.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=s.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){var n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var i=s.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){var c=r(arguments[0]),d=i(c),u=o(arguments[0],c),l=void 0;l=0===d&&0===u?Number.POSITIVE_INFINITY:0===d||0===u?Math.max(d,u):Math.min(d,u);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return l}}),this._sctp=p}return a.apply(this,arguments)}}},n.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},c.wrapPeerConnectionEvent(e,"datachannel",(function(e){return n(e.channel,e.target),e}))}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}},n.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}},n.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=c.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),n.apply(this,arguments)}}}};var i,o=e("sdp"),s=(i=o)&&i.__esModule?i:{default:i},c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return r.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),n.shimPeerConnection=function(e){var t=a.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var r=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,s.filterIceServers)(e.iceServers,t.version),a.log("ICE servers after filtering:",e.iceServers)),new r(e)},e.RTCPeerConnection.prototype=r.prototype},n.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var o,a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils")),s=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(o=c)&&o.__esModule?o:{default:o}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.filterIceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!n?(n=!0,!0):t&&!n})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetUserMedia=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=n.shimGetUserMedia=void 0;var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)},i=e("./getusermedia");Object.defineProperty(n,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var o=e("./getdisplaymedia");Object.defineProperty(n,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}}),n.shimOnTrack=function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimPeerConnection=function(e){var t=s.detectBrowser(e);if("object"===(void 0===e?"undefined":r(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n,r,i,o=e.RTCPeerConnection.prototype[t],a=(i=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)},(r=t)in(n={})?Object.defineProperty(n,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[r]=i,n);e.RTCPeerConnection.prototype[t]=a[t]})),t.version<68){var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],r=e[1],a=e[2];return o.apply(this,[n||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,a)}}},n.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},n.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(this,[]);return n.forEach((function(t){return t._pc=e})),n}),s.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},n.shimRemoveStream=function(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;s.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(n){n.track&&e.getTracks().includes(n.track)&&t.removeTrack(n)}))})},n.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},n.shimAddTransceiver=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var r=t.apply(this,arguments);if(n){var i=r.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===Object.keys(o.encodings[0]).length)&&(o.encodings=e.sendEncodings,i.sendEncodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return r})}},n.shimGetParameters=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}},n.shimCreateOffer=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}},n.shimCreateAnswer=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,n=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,n)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){var r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,Promise.reject(r)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)};n.shimGetUserMedia=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,o=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},s=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":r(e))&&"object"===r(e.audio)&&(e=JSON.parse(JSON.stringify(e)),a(e.audio,"autoGainControl","mozAutoGainControl"),a(e.audio,"noiseSuppression","mozNoiseSuppression")),s(e)},o&&o.prototype.getSettings){var c=o.prototype.getSettings;o.prototype.getSettings=function(){var e=c.apply(this,arguments);return a(e,"mozAutoGainControl","autoGainControl"),a(e,"mozNoiseSuppression","noiseSuppression"),e}}if(o&&o.prototype.applyConstraints){var d=o.prototype.applyConstraints;o.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":r(e))&&(e=JSON.parse(JSON.stringify(e)),a(e,"autoGainControl","mozAutoGainControl"),a(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)};n.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(r){return t.call(n,r,e)})),e.getVideoTracks().forEach((function(r){return t.call(n,r,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=this,r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){n._localStreams?n._localStreams.includes(e)||n._localStreams.push(e):n._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var n=this._localStreams.indexOf(e);if(-1!==n){this._localStreams.splice(n,1);var r=e.getTracks();this.getSenders().forEach((function(e){r.includes(e.track)&&t.removeTrack(e)}))}})}},n.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}}))}),t.apply(e,arguments)}}},n.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":r(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},n.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=function(e){return r(o(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))},n.shimConstraints=o,n.shimRTCIceServerUrls=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var a=e.iceServers[o];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,r.push(a)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}},n.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":r(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},n.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var n=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveAudio||n||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video")}return t.apply(this,arguments)}},n.shimAudioContext=function(e){"object"!==(void 0===e?"undefined":r(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utils"));function o(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"===a(Symbol.iterator)?function(e){return a(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":a(e)};n.extractVersion=s,n.wrapPeerConnectionEvent=function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);var r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},n.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},n.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":r(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},n.log=function(){if("object"===("undefined"==typeof window?"undefined":r(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},n.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},n.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var n=e.navigator;if(n.mozGetUserMedia)t.browser="firefox",t.version=s(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=s(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(n.mediaDevices&&n.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=s(n.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=s(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},n.compactObject=function e(t){return c(t)?Object.keys(t).reduce((function(n,r){var i=c(t[r]),o=i?e(t[r]):t[r],a=i&&!Object.keys(o).length;return void 0===o||a?n:Object.assign(n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},r,o))}),{}):t},n.walkStats=d,n.filterStats=function(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(n){n.type===r&&n.trackId===t.id&&d(e,n,i)}))})),i};var i=!0,o=!0;function s(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function d(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((function(r){r.endsWith("Id")?d(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((function(t){d(e,e.get(t),n)}))})))}},{}],16:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var a=r.writeRtpDescription(e.kind,t);if(a+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),a+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var s=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=s;var c="msid:"+(i?i.id:"-")+" "+s+"\r\n";a+="a="+c,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),a}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),a=r(t.parameters.apt,i);return o&&a&&o.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach((function(r){for(var o=0;o<t.codecs.length;o++){var a=t.codecs[o];if(r.name.toLowerCase()===a.name.toLowerCase()&&r.clockRate===a.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&a.parameters.apt&&!i(r,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(r.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}})),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var u=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)})),delete e.url,e.urls=i?r[0]:r,!!r.length}}))}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var a=n.iceCandidatePoolSize;a>0;a--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},u.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},u.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var r=e.clone();e.getTracks().forEach((function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),r.getTracks().forEach((function(e){n.addTrack(e,r)}))}},u.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find((function(e){return e.rtpSender===t}));if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var n=t.getSenders().find((function(t){return t.track===e}));n&&t.removeTrack(n)}))},u.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},u.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},u.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},u.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var a=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var a=new Event("icecandidate");a.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate,c=!s||0===Object.keys(s).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),s.component=1,s.ufrag=o.getLocalParameters().usernameFragment;var d=r.writeCandidate(s);a.candidate=Object.assign(a.candidate,r.parseCandidate(d)),a.candidate.candidate=d,a.candidate.toJSON=function(){return{candidate:a.candidate.candidate,sdpMid:a.candidate.sdpMid,sdpMLineIndex:a.candidate.sdpMLineIndex,usernameFragment:a.candidate.usernameFragment}}}var u=r.getMediaSections(i._localDescription.sdp);u[a.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+a.candidate.candidate+"\r\n",i._localDescription.sdp=r.getDescription(i._localDescription.sdp)+u.join("");var l=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",a),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){a.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,i){var a=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(a.encodings=e.sendEncodingParameters,a.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(a.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(a)),i&&e.rtpReceiver&&a.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?a.encodings=e.recvEncodingParameters:a.encodings=[{}],a.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(a.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(a.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(a))},u.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!a("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach((function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=r.splitSections(i._remoteDescription.sdp),n=t.shift();var s=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach((function(e,t){var a=i.transceivers[t],c=a.iceGatherer,d=a.iceTransport,u=a.dtlsTransport,l=a.localCapabilities,p=a.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length||a.rejected)){var f=r.getIceParameters(e,n),m=r.getDtlsParameters(e,n);s&&(m.role="server"),i.usingBundle&&0!==t||(i._gather(a.mid,t),"new"===d.state&&d.start(c,f,s?"controlling":"controlled"),"new"===u.state&&u.start(m));var v=o(l,p);i._transceive(a,v.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(i){var u=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!a("setRemoteDescription",i.type,u.signalingState)||u._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+u.signalingState));var l={};u.remoteStreams.forEach((function(e){l[e.id]=e}));var p=[],f=r.splitSections(i.sdp),m=f.shift(),v=r.matchPrefix(m,"a=ice-lite").length>0,h=r.matchPrefix(m,"a=group:BUNDLE ").length>0;u.usingBundle=h;var g=r.matchPrefix(m,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,f.forEach((function(a,c){var d=r.splitLines(a),f=r.getKind(a),g=r.isRejected(a)&&0===r.matchPrefix(a,"a=bundle-only").length,y=d[0].substr(2).split(" ")[2],C=r.getDirection(a,m),S=r.parseMsid(a),b=r.getMid(a)||r.generateIdentifier();if(g||"application"===f&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))u.transceivers[c]={mid:b,kind:f,protocol:y,rejected:!0};else{var T,w,R,k,P,E,x,M,O;!g&&u.transceivers[c]&&u.transceivers[c].rejected&&(u.transceivers[c]=u._createTransceiver(f,!0));var A,D,I=r.parseRtpParameters(a);g||(A=r.getIceParameters(a,m),(D=r.getDtlsParameters(a,m)).role="client"),x=r.parseRtpEncodingParameters(a);var _=r.parseRtcpParameters(a),L=r.matchPrefix(a,"a=end-of-candidates",m).length>0,U=r.matchPrefix(a,"a=candidate:").map((function(e){return r.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&h&&c>0&&u.transceivers[c]&&(u._disposeIceAndDtlsTransports(c),u.transceivers[c].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[c].iceTransport=u.transceivers[0].iceTransport,u.transceivers[c].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[c].rtpSender&&u.transceivers[c].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[c].rtpReceiver&&u.transceivers[c].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(w=(T=u.transceivers[c]).iceGatherer,R=T.iceTransport,k=T.dtlsTransport,P=T.rtpReceiver,E=T.sendEncodingParameters,M=T.localCapabilities,u.transceivers[c].recvEncodingParameters=x,u.transceivers[c].remoteCapabilities=I,u.transceivers[c].rtcpParameters=_,U.length&&"new"===R.state&&(!v&&!L||h&&0!==c?U.forEach((function(e){s(T.iceTransport,e)})):R.setRemoteCandidates(U)),h&&0!==c||("new"===R.state&&R.start(w,A,"controlling"),"new"===k.state&&k.start(D)),!o(T.localCapabilities,T.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,u._transceive(T,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!P||"sendrecv"!==C&&"sendonly"!==C?delete T.rtpReceiver:(O=P.track,S?(l[S.stream]||(l[S.stream]=new e.MediaStream),n(O,l[S.stream]),p.push([O,P,l[S.stream]])):(l.default||(l.default=new e.MediaStream),n(O,l.default),p.push([O,P,l.default]))));else{(T=u.transceivers[c]||u._createTransceiver(f)).mid=b,T.iceGatherer||(T.iceGatherer=u._createIceGatherer(c,h)),U.length&&"new"===T.iceTransport.state&&(!L||h&&0!==c?U.forEach((function(e){s(T.iceTransport,e)})):T.iceTransport.setRemoteCandidates(U)),M=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(M.codecs=M.codecs.filter((function(e){return"rtx"!==e.name}))),E=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var N,j=!1;"sendrecv"===C||"sendonly"===C?(j=!T.rtpReceiver,P=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,f),j&&(O=P.track,S&&"-"===S.stream||(S?(l[S.stream]||(l[S.stream]=new e.MediaStream,Object.defineProperty(l[S.stream],"id",{get:function(){return S.stream}})),Object.defineProperty(O,"id",{get:function(){return S.track}}),N=l[S.stream]):(l.default||(l.default=new e.MediaStream),N=l.default)),N&&(n(O,N),T.associatedRemoteMediaStreams.push(N)),p.push([O,P,N]))):T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach((function(t){var n=t.getTracks().find((function(e){return e.id===T.rtpReceiver.track.id}));n&&function(t,n){n.removeTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(n,t)})),T.associatedRemoteMediaStreams=[]),T.localCapabilities=M,T.remoteCapabilities=I,T.rtpReceiver=P,T.rtcpParameters=_,T.sendEncodingParameters=E,T.recvEncodingParameters=x,u._transceive(u.transceivers[c],!1,j)}}})),void 0===u._dtlsRole&&(u._dtlsRole="offer"===i.type?"active":"passive"),u._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(l).forEach((function(t){var n=l[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout((function(){u._dispatchEvent("addstream",r)}))}p.forEach((function(e){var t=e[0],r=e[1];n.id===e[2].id&&d(u,t,r,[n])}))}})),p.forEach((function(e){e[2]||d(u,e[0],e[1],[])})),e.setTimeout((function(){u&&u.transceivers&&u.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter((function(e){return"audio"===e.kind})).length,a=n.transceivers.filter((function(e){return"video"===e.kind})).length,s=arguments[0];if(s){if(s.mandatory||s.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==s.offerToReceiveAudio&&(o=!0===s.offerToReceiveAudio?1:!1===s.offerToReceiveAudio?0:s.offerToReceiveAudio),void 0!==s.offerToReceiveVideo&&(a=!0===s.offerToReceiveVideo?1:!1===s.offerToReceiveVideo?0:s.offerToReceiveVideo)}for(n.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--a<0&&(e.wantReceive=!1)}));o>0||a>0;)o>0&&(n._createTransceiver("audio"),o--),a>0&&(n._createTransceiver("video"),a--);var d=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach((function(i,o){var a=i.track,s=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var d=e.RTCRtpSender.getCapabilities(s);t<15019&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),d.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var u=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];a&&t>=15019&&"video"===s&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=d,i.sendEncodingParameters=u})),"max-compat"!==n._config.bundlePolicy&&(d+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",n.transceivers.forEach((function(e,t){d+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,d+="a="+r.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))}));var u=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(u)},u.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var a=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(a+="a=group:BUNDLE "+n.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),a+="a=ice-options:trickle\r\n";var s=r.getMediaSections(n._remoteDescription.sdp).length;n.transceivers.forEach((function(e,r){if(!(r+1>s)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?a+="m=application 0 DTLS/SCTP 5000\r\n":a+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?a+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(a+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(a+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var d=o(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=i(e,d,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}}));var d=new e.RTCSessionDescription({type:"answer",sdp:a});return Promise.resolve(d)},u.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,o){if(!n._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var a=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<n.transceivers.length;d++)if(n.transceivers[d].mid===e.sdpMid){a=d;break}var u=n.transceivers[a];if(!u)return o(c("OperationError","Can not add ICE candidate"));if(u.rejected)return i();var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===a||a>0&&u.iceTransport!==n.transceivers[0].iceTransport)&&!s(u.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=r.getMediaSections(n._remoteDescription.sdp))[a]+="a="+(l.type?p:"end-of-candidates")+"\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join("")}else for(var f=0;f<n.transceivers.length&&(n.transceivers[f].rejected||(n.transceivers[f].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",n._remoteDescription.sdp=r.getDescription(n._remoteDescription.sdp)+t.join(""),!n.usingBundle));f++);i()}))},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)})),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&r.push(e[t].getStats())}))})),Promise.all(r).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])})),t}))}}}));var l=["createOffer","createAnswer"];return l.forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),u}},{sdp:17}],17:[function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},r.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},r.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},r.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===a(e.keyParams)?r.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},r.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},r.getCryptoParameters=function(e,t){return r.matchPrefix(e+t,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(e,t){var n=r.matchPrefix(e+t,"a=ice-ufrag:")[0],i=r.matchPrefix(e+t,"a=ice-pwd:")[0];return n&&i?{usernameFragment:n.substr(12),password:i.substr(10)}:null},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],a=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(a){var s=r.parseRtpMap(a),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(s.parameters=c.length?r.parseFmtp(c[0]):{},s.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(r.parseExtmap(e))})),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){n+=r.writeExtmap(e)})),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),s=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=s.length>0&&s[0].ssrc,d=r.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:c,mechanism:a?"red+ulpfec":"red"},n.push(r))}})),0===n.length&&c&&n.push({ssrc:c});var u=r.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,n.forEach((function(e){e.maxBitrate=u}))),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map((function(e){return r.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.parseSctpDescription=function(e){var t,n=r.parseMLine(e),i=r.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=r.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:t};if(r.matchPrefix(e,"a=sctpmap:").length>0){var a=r.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},r.writeSctpDescription=function(e,t){var n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t,n){var i=void 0!==t?t:2;return"v=0\r\no="+(n||"thisisadapterortc")+" "+(e||r.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+a,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},r.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=r.splitLines(e),n=0;n<t.length;n++)if(t[n].length<2||"="!==t[n].charAt(1))return!1;return!0},"object"===a(t)&&(t.exports=r)},{}]},{},[1])(1)},"object"===a(t)?e.exports=o():(r=[],void 0===(i="function"==typeof(n=o)?n.apply(t,r):n)||(e.exports=i))},19194:(e,t,n)=>{"use strict";var r,i=n(34155);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var a=function(a,s){var c;function d(e,t){function n(e){return!e.audio&&!e.video&&!e.screen&&e.data}var r="";r+="?userid="+e.userid,r+="&sessionid="+e.sessionid,r+="&msgEvent="+e.socketMessageEvent,r+="&socketCustomEvent="+e.socketCustomEvent,r+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(r+="&oneToMany=true"),r+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(r+="&enableScalableBroadcast=true",r+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),r+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(r+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=io(e.socketURL+r)}catch(t){e.socket=io.connect(e.socketURL+r,e.socketOptions)}var i=e.multiPeersHandler;function o(t,n){e.peersBackup[t]||(e.peersBackup[t]={userid:t,extra:{}}),e.peersBackup[t].extra=n}e.socket.on("extra-data-updated",(function(t,n){e.peers[t]&&(e.peers[t].extra=n,e.onExtraDataUpdated({userid:t,extra:n}),o(t,n))})),e.socket.on(e.socketMessageEvent,(function t(r){if(r.remoteUserId==e.userid)if(e.peers[r.sender]&&e.peers[r.sender].extra!=r.message.extra&&(e.peers[r.sender].extra=r.extra,e.onExtraDataUpdated({userid:r.sender,extra:r.extra}),o(r.sender,r.extra)),r.message.streamSyncNeeded&&e.peers[r.sender]){var a=e.streamEvents[r.message.streamid];if(!a||!a.stream)return;var s=r.message.action;if("ended"===s||"inactive"===s||"stream-removed"===s)return e.peersBackup[a.userid]&&(a.extra=e.peersBackup[a.userid].extra),void e.onstreamended(a);var c="both"!=r.message.type?r.message.type:null;"function"==typeof a.stream[s]&&a.stream[s](c)}else if("dropPeerConnection"!==r.message){if(r.message.allParticipants)return-1===r.message.allParticipants.indexOf(r.sender)&&r.message.allParticipants.push(r.sender),void r.message.allParticipants.forEach((function(t){i[e.peers[t]?"renegotiatePeer":"createNewPeer"](t,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}));if(r.message.newParticipant){if(r.message.newParticipant==e.userid)return;if(e.peers[r.message.newParticipant])return;i.createNewPeer(r.message.newParticipant,r.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:n(e.session)})}else if(r.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))setTimeout((function(){t(r)}),1);else if(r.message.newParticipationRequest&&r.sender!==e.userid){e.peers[r.sender]&&e.deletePeer(r.sender);var d={extra:r.extra||{},localPeerSdpConstraints:r.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:r.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==r.message.isOneWay?r.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==r.message.isDataOnly?r.message.isDataOnly:n(e.session),dontGetRemoteStream:void 0!==r.message.isOneWay?r.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!r.message.dontGetRemoteStream,connectionDescription:r,successCallback:function(){}};e.onNewParticipant(r.sender,d)}else{if(r.message.changedUUID&&e.peers[r.message.oldUUID]&&(e.peers[r.message.newUUID]=e.peers[r.message.oldUUID],delete e.peers[r.message.oldUUID]),r.message.userLeft)return i.onUserLeft(r.sender),void(r.message.autoCloseEntireSession&&e.leave());i.addNegotiatedMessage(r.message,r.sender)}}else e.deletePeer(r.sender)}));var a=!1;e.socket.resetProps=function(){a=!1},e.socket.on("connect",(function(){a||(a=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout((function(){e.socket.emit("extra-data-updated",e.extra)}),1e3),t&&t(e.socket))})),e.socket.on("disconnect",(function(t){e.onSocketDisconnect(t)})),e.socket.on("error",(function(t){e.onSocketError(t)})),e.socket.on("user-disconnected",(function(t){t!==e.userid&&(e.onUserStatusChanged({userid:t,status:"offline",extra:e.peers[t]&&e.peers[t].extra||{}}),e.deletePeer(t))})),e.socket.on("user-connected",(function(t){t!==e.userid&&e.onUserStatusChanged({userid:t,status:"online",extra:e.peers[t]&&e.peers[t].extra||{}})})),e.socket.on("closed-entire-session",(function(t,n){e.leave(),e.onEntireSessionClosed({sessionid:t,userid:t,extra:n})})),e.socket.on("userid-already-taken",(function(t,n){e.onUserIdAlreadyTaken(t,n)})),e.socket.on("logs",(function(t){e.enableLogs&&console.debug("server-logs",t)})),e.socket.on("number-of-broadcast-viewers-updated",(function(t){e.onNumberOfBroadcastViewersUpdated(t)})),e.socket.on("set-isInitiator-true",(function(t){t==e.sessionid&&(e.isInitiator=!0)}))}function u(e){var t=this,n=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function r(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(t){e.onFileProgress(t)},e.fbr.onBegin=function(t){e.onFileStart(t)},e.fbr.onEnd=function(t){e.onFileEnd(t)}}e.peers={getLength:function(){var e=0;for(var t in this)-1==n.indexOf(t)&&e++;return e},selectFirst:function(){var e;for(var t in this)-1==n.indexOf(t)&&(e=this[t]);return e},getAllParticipants:function(e){var t=[];for(var r in this)-1==n.indexOf(r)&&r!=e&&t.push(r);return t},forEach:function(t){this.getAllParticipants().forEach((function(n){t(e.peers[n])}))},send:function(n,r){var i=this;if(!y(n.size)&&!y(n.type)){if(e.enableFileSharing)return void t.shareFile(n,r);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),r){var o=e.peers[r];if(o)return o.channels.length?void o.channels.forEach((function(e){e.send(n)})):(e.peers[r].createDataChannel(),e.renegotiate(r),void setTimeout((function(){i.send(n,r)}),3e3))}this.getAllParticipants().forEach((function(t){if(!i[t].channels.length)return e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout((function(){i[t].channels.forEach((function(e){e.send(n)}))}),3e3);i[t].channels.forEach((function(e){e.send(n)}))}))}else N.send({text:n,channel:this,connection:e,remoteUserId:r})}},this.uuid=e.userid,this.getLocalConfig=function(n,i,o){return o||(o={}),{streamsToShare:o.streamsToShare||{},rtcMultiConnection:e,connectionDescription:o.connectionDescription,userid:i,localPeerSdpConstraints:o.localPeerSdpConstraints,remotePeerSdpConstraints:o.remotePeerSdpConstraints,dontGetRemoteStream:!!o.dontGetRemoteStream,dontAttachLocalStream:!!o.dontAttachLocalStream,renegotiatingPeer:!!o.renegotiatingPeer,peerRef:o.peerRef,channels:o.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,i)},onLocalCandidate:function(n){(n=D.processCandidates(e,n))&&t.onNegotiationNeeded(n,i)},remoteSdp:n,onDataChannelMessage:function(n){if(!e.fbr&&e.enableFileSharing&&r(),"string"!=typeof n&&e.enableFileSharing){var o=this;n instanceof ArrayBuffer||n instanceof DataView?e.fbr.convertToObject(n,(function(e){o.onDataChannelMessage(e)})):n.readyForNextChunk?e.fbr.getNextChunk(n,(function(t,n){e.peers[i].channels.forEach((function(e){e.send(t)}))}),i):n.chunkMissing?e.fbr.chunkMissing(n):e.fbr.addChunk(n,(function(t){e.peers[i].peer.channel.send(t)}))}else t.onDataChannelMessage(n,i)},onDataChannelError:function(e){t.onDataChannelError(e,i)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,i)},onRemoteStream:function(n){e.peers[i]&&e.peers[i].streams.push(n),t.onGettingRemoteMedia(n,i)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(i),t.disconnectWith(i))}}},this.createNewPeer=function(t,n){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(n=n||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!n.streamsToShare&&(n.isOneWay=!1,n.isDataOnly=!1,n.session=e.session),!n.isOneWay&&!n.isDataOnly)return n.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:n},t);n=e.setUserPreferences(n,t);var r=this.getLocalConfig(null,t,n);e.peers[t]=new O(r)}},this.createAnsweringPeer=function(t,n,r){r=e.setUserPreferences(r||{},n);var i=this.getLocalConfig(t,n,r);e.peers[n]=new O(i)},this.renegotiatePeer=function(t,n,r){if(e.peers[t]){n||(n={}),n.renegotiatingPeer=!0,n.peerRef=e.peers[t].peer,n.channels=e.peers[t].channels;var i=this.getLocalConfig(r,t,n);e.peers[t]=new O(i)}else e.enableLogs&&console.error("Peer ("+t+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(t,n,r){if(!e.peers[n])throw"This peer ("+n+") does not exist.";var i=e.peers[n].peer;i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?i.getSenders().forEach((function(i){r&&i.track&&"video"===i.track.kind&&(e.peers[n].peer.lastVideoTrack=i.track,i.replaceTrack(t)),!r&&i.track&&"audio"===i.track.kind&&(e.peers[n].peer.lastAudioTrack=i.track,i.replaceTrack(t))})):(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(n))},this.onNegotiationNeeded=function(e,t){},this.addNegotiatedMessage=function(n,r){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[r]&&e.peers[r].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(r,null,n):this.createAnsweringPeer(n,r)),void(e.enableLogs&&console.log("Remote peer's sdp:",n.sdp));if(n.candidate)return e.peers[r]&&e.peers[r].addRemoteCandidate(n),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",n.candidate));if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach((function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),n.userPreferences.streamsToShare=i,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},r)}n.readyForOffer&&e.onReadyForOffer(r,n.userPreferences)},this.onGettingRemoteMedia=function(e,t){},this.onRemovingRemoteMedia=function(e,t){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(t,n){e.onMediaError(t,n)},this.shareFile=function(t,n){r(),e.fbr.readAsArrayBuffer(t,(function(t){var r=e.getAllParticipants();n&&(r=[n]),r.forEach((function(n){e.fbr.getNextChunk(t,(function(t){e.peers[n].channels.forEach((function(e){e.send(t)}))}),n)}))}),{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new U(e);this.onDataChannelMessage=function(t,n){i.receive(JSON.parse(t),n,e.peers[n]?e.peers[n].extra:{})},this.onDataChannelClosed=function(t,n){t.userid=n,t.extra=e.peers[n]?e.peers[n].extra:{},e.onclose(t)},this.onDataChannelError=function(t,n){t.userid=n,event.extra=e.peers[n]?e.peers[n].extra:{},e.onerror(t)},this.onDataChannelOpened=function(t,n){e.peers[n].channels.length?e.peers[n].channels=[t]:(e.peers[n].channels.push(t),e.onopen({userid:n,extra:e.peers[n]?e.peers[n].extra:{},channel:t}))},this.onPeerStateChanged=function(t){e.onPeerStateChanged(t)},this.onNegotiationStarted=function(e,t){},this.onNegotiationCompleted=function(e,t){},this.getRemoteStreams=function(t){return t=t||e.peers.getAllParticipants()[0],e.peers[t]?e.peers[t].streams:[]}}function l(e,t,n){if("undefined"!=typeof CustomEvent){var r=new CustomEvent(t,{arguments:n,__exposedProps__:n});e.dispatchEvent(r)}}function p(e,t){t.stream&&t.stream&&t.stream.addEventListener&&(t.stream.addEventListener("mute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.muteType,video:"video"===n.muteType},e.onmute(n)}),!1),t.stream.addEventListener("unmute",(function(n){(n=e.streamEvents[t.streamid]).session={audio:"audio"===n.unmuteType,video:"video"===n.unmuteType},e.onunmute(n)}),!1))}function f(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",n=0,r=e.length;n<r;n++)t+=e[n].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function m(e,t,n){if(n.autoCreateMediaElement){var r=!1;b(e,"video").length||e.isVideo||e.isScreen||(r=!0),"Firefox"===DetectRTC.browser.name&&(n.session.video||n.session.screen)&&(r=!1);var i=document.createElement(r?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var o="ended";"oninactive"in i&&(o="inactive"),i.addEventListener(o,(function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){o="ended","oninactive"in e&&(o="inactive"),L.onSyncNeeded(e.streamid,o),n.attachStreams.forEach((function(t,r){e.streamid===t.streamid&&delete n.attachStreams[r]}));var t=[];n.attachStreams.forEach((function(e){e&&t.push(e)})),n.attachStreams=t;var r=n.streamEvents[e.streamid];if(r)return void n.onstreamended(r);this.parentNode&&this.parentNode.removeChild(this)}}),!1)}var a=i.play();if(void 0!==a){var s=!1;setTimeout((function(){s||(s=!0,t(i))}),1e3),a.then((function(){s||(s=!0,t(i))})).catch((function(e){s||(s=!0,t(i))}))}else t(i)}else t({})}function v(e,t){window.removeEventListener(e,t),window.addEventListener(e,t,!1)}function h(e){var t=[];return e.forEach((function(e){e&&t.push(e)})),t}function g(e){return!e.audio&&!e.video&&!e.screen&&e.data}function y(e){return void 0===e}(c=void 0!==n.g?n.g:null)&&"undefined"==typeof window&&void 0!==n.g&&(n.g.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},n.g.console||(n.g.console={}),void 0===n.g.console.debug&&(n.g.console.debug=n.g.console.info=n.g.console.error=n.g.console.log=n.g.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(c.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=c.addEventListener=c.removeEventListener=function(){},c.HTMLVideoElement=c.HTMLMediaElement=function(){}),"undefined"==typeof io&&(c.io=function(){return{on:function(e,t){t=t||function(){},"connect"===e&&t()},emit:function(e,t,n){n=n||function(){},"open-room"!==e&&"join-room"!==e||n(!0,t.sessionid,null)}}}),"undefined"==typeof location&&(c.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(c.screen={width:0,height:0}),"undefined"==typeof URL&&(c.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),c.window=n.g),function(){var a="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(w="object"===(void 0===i?"undefined":o(i))&&"object"===o(i.versions)&&i.versions.node&&!i.browser){var s=i.versions.node.toString().replace("v","");a="Nodejs/"+s+" (NodeOS) AppleWebKit/"+s+" (KHTML, like Gecko) Nodejs/"+s+" Nodejs/"+s}!function(e){"undefined"==typeof window&&("undefined"==typeof window&&void 0!==n.g&&(n.g.navigator={userAgent:a,getUserMedia:function(){}},e.window=n.g),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}))}(void 0!==n.g?n.g:window);var c=window.navigator;void 0!==c?(void 0!==c.webkitGetUserMedia&&(c.getUserMedia=c.webkitGetUserMedia),void 0!==c.mozGetUserMedia&&(c.getUserMedia=c.mozGetUserMedia)):c={getUserMedia:function(){},userAgent:a};var d=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(c.userAgent||""),u=!(-1===c.userAgent.indexOf("Edge")||!c.msSaveOrOpenBlob&&!c.msSaveBlob),l=!!window.opera||c.userAgent.indexOf(" OPR/")>=0,p=void 0!==window.InstallTrigger,f=/^((?!chrome|android).)*safari/i.test(c.userAgent),m=!!window.chrome&&!l,v="undefined"!=typeof document&&!!document.documentMode&&!u;function h(e,t){var n=0,r=!1,i=window.setInterval((function(){e()&&(window.clearInterval(i),t(r)),n++>50&&(window.clearInterval(i),t(r=!0))}),10)}var g={Android:function(){return c.userAgent.match(/Android/i)},BlackBerry:function(){return c.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return c.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return c.userAgent.match(/Opera Mini/i)},Windows:function(){return c.userAgent.match(/IEMobile/i)},any:function(){return g.Android()||g.BlackBerry()||g.iOS()||g.Opera()||g.Windows()},getOsName:function(){var e="Unknown OS";return g.Android()&&(e="Android"),g.BlackBerry()&&(e="BlackBerry"),g.iOS()&&(e="iOS"),g.Opera()&&(e="Opera Mini"),g.Windows()&&(e="Windows"),e}};var y="Unknown OS",C="Unknown OS Version";var S,b,T=function(){for(var e,t=c.appVersion,n=c.userAgent,r="-",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],o=0;e=i[o];o++)if(e.r.test(n)){r=e.s;break}var a="-";switch(/Windows/.test(r)&&(/Windows (.*)/.test(r)&&(a=/Windows (.*)/.exec(r)[1]),r="Windows"),r){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(n)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(n)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(n)&&(a=/Android ([\.\_\d]+)/.exec(n)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(n)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(t))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:r,osVersion:a}}();T&&T.osName&&"-"!=T.osName?(y=T.osName,C=T.osVersion):g.any()&&"Android"==(y=g.getOsName())&&(C=!!(b=(S=(S||c.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&b[1]);var w="object"===(void 0===i?"undefined":o(i))&&"object"===o(i.versions)&&i.versions.node;"Unknown OS"===y&&w&&(y="Nodejs",C=i.versions.node.toString().replace("v",""));var R=!1,k=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach((function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!R&&e in document.createElement("canvas")&&(R=!0),!k&&e in document.createElement("video")&&(k=!0))}));var P=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,E=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,x=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;var O=[],A=[],D=[],I=[];c.mediaDevices&&c.mediaDevices.enumerateDevices&&(c.enumerateDevices=function(e){var t=c.mediaDevices.enumerateDevices();t&&t.then?c.mediaDevices.enumerateDevices().then(e).catch((function(){e([])})):e([])});var _=!1;(void 0!==M&&"getSources"in M||c.mediaDevices&&c.mediaDevices.enumerateDevices)&&(_=!0);var L=!1,U=!1,N=!1,j=!1,F=!1;function B(e){if(_)if(!c.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(c.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!c.enumerateDevices&&c.enumerateDevices&&(c.enumerateDevices=c.enumerateDevices.bind(c)),c.enumerateDevices){O=[],A=[],D=[],I=[],L=!1,U=!1,N=!1,j=!1,F=!1;var t={};c.enumerateDevices((function(n){n.forEach((function(e){var n={};for(var r in e)try{"function"!=typeof e[r]&&(n[r]=e[r])}catch(e){}t[n.deviceId+n.label+n.kind]||("audio"===n.kind&&(n.kind="audioinput"),"video"===n.kind&&(n.kind="videoinput"),n.deviceId||(n.deviceId=n.id),n.id||(n.id=n.deviceId),n.label?("videoinput"!==n.kind||F||(F=!0),"audioinput"!==n.kind||j||(j=!0)):(n.isCustomLabel=!0,"videoinput"===n.kind?n.label="Camera "+(I.length+1):"audioinput"===n.kind?n.label="Microphone "+(A.length+1):"audiooutput"===n.kind?n.label="Speaker "+(D.length+1):n.label="Please invoke getUserMedia once.",void 0!==G&&G.browser.isChrome&&G.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(n.label="HTTPs is required to get label of this "+n.kind+" device.")),"audioinput"===n.kind&&(L=!0,-1===A.indexOf(n)&&A.push(n)),"audiooutput"===n.kind&&(U=!0,-1===D.indexOf(n)&&D.push(n)),"videoinput"===n.kind&&(N=!0,-1===I.indexOf(n)&&I.push(n)),O.push(n),t[n.deviceId+n.label+n.kind]=n)})),void 0!==G&&(G.MediaDevices=O,G.hasMicrophone=L,G.hasSpeakers=U,G.hasWebcam=N,G.isWebsiteHasWebcamPermissions=F,G.isWebsiteHasMicrophonePermissions=j,G.audioInputDevices=A,G.audioOutputDevices=D,G.videoInputDevices=I),e&&e()}))}else e&&e();else e&&e()}var G=window.DetectRTC||{};G.browser=function(){c.appVersion;var e,t,n,r=c.userAgent,i=c.appName,o=""+parseFloat(c.appVersion),a=parseInt(c.appVersion,10);if(f&&!m&&-1!==r.indexOf("CriOS")&&(f=!1,m=!0),l){i="Opera";try{a=(o=c.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){o="0.0.0.0",a=0}}else v?((t=r.indexOf("rv:"))>0?o=r.substring(t+3):(t=r.indexOf("MSIE"),o=r.substring(t+5)),i="IE"):m?(t=r.indexOf("Chrome"),i="Chrome",o=r.substring(t+7)):f?(t=r.indexOf("Safari"),i="Safari",o=r.substring(t+7),-1!==(t=r.indexOf("Version"))&&(o=r.substring(t+8)),-1!==c.userAgent.indexOf("Version/")&&(o=c.userAgent.split("Version/")[1].split(" ")[0])):p?(t=r.indexOf("Firefox"),i="Firefox",o=r.substring(t+8)):(e=r.lastIndexOf(" ")+1)<(t=r.lastIndexOf("/"))&&(i=r.substring(e,t),o=r.substring(t+1),i.toLowerCase()===i.toUpperCase()&&(i=c.appName));return u&&(i="Edge",o=c.userAgent.split("Edge/")[1]),-1!==(n=o.search(/[; \)]/))&&(o=o.substring(0,n)),a=parseInt(""+o,10),isNaN(a)&&(o=""+parseFloat(c.appVersion),a=parseInt(c.appVersion,10)),{fullVersion:o,version:a,name:i,isPrivateBrowsing:!1}}(),function(e){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,(function(){t=!1}),(function(e){t=!0}));else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var n;try{(n=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){t=!0}void 0===t&&h((function(){return"done"===n.readyState}),(function(e){e||(t=!n.result)}))}else if(function(e){var t=e.toLowerCase();if(0===t.indexOf("msie")&&0===t.indexOf("trident"))return!1;var n=/(?:msie|rv:)\s?([\d\.]+)/.exec(t);return!!(n&&parseInt(n[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(e){t=!1}h((function(){return void 0!==t}),(function(n){e(t)}))}((function(e){G.browser.isPrivateBrowsing=!!e})),G.browser["is"+G.browser.name]=!0,G.osName=y,G.osVersion=C;"object"===(void 0===i?"undefined":o(i))&&"object"===o(i.versions)&&i.versions["node-webkit"];var V=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){V||e in window&&(V=!0)})),G.isWebRTCSupported=V,G.isORTCSupported="undefined"!=typeof RTCIceGatherer;var W=!1;((G.browser.isChrome&&G.browser.version>=35||G.browser.isFirefox&&G.browser.version>=34||G.browser.isEdge&&G.browser.version>=17||"Android"===G.osName&&G.browser.isChrome)&&(W=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(G.browser.isChrome||G.browser.isEdge||G.browser.isOpera)||G.browser.isFirefox)&&(W=!1);G.isScreenCapturingSupported=W;var z={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach((function(e){z.isSupported||e in window&&(z.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(z.isCreateMediaStreamSourceSupported=!0))})),G.isAudioContextSupported=z.isSupported,G.isCreateMediaStreamSourceSupported=z.isCreateMediaStreamSourceSupported;var q=!1;G.browser.isChrome&&G.browser.version>31&&(q=!0),G.isRtpDataChannelsSupported=q;var H=!1;(G.browser.isFirefox&&G.browser.version>28||G.browser.isChrome&&G.browser.version>25||G.browser.isOpera&&G.browser.version>=11)&&(H=!0),G.isSctpDataChannelsSupported=H,G.isMobileDevice=d;var Y=!1;(c.getUserMedia||c.mediaDevices&&c.mediaDevices.getUserMedia)&&(Y=!0),G.browser.isChrome&&G.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(Y="Requires HTTPs"),"Nodejs"===G.osName&&(Y=!1),G.isGetUserMediaSupported=Y;var J,K,X,$="";screen.width&&($+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));G.displayResolution=$,G.displayAspectRatio=(J=screen.width,K=screen.height,X=function e(t,n){return 0==n?t:e(n,t%n)}(J,K),J/X/(K/X)).toFixed(2),G.isCanvasSupportsStreamCapturing=R,G.isVideoSupportsStreamCapturing=k,"Chrome"==G.browser.name&&G.browser.version>=53&&(G.isCanvasSupportsStreamCapturing||(G.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),G.isVideoSupportsStreamCapturing||(G.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),G.DetectLocalIPAddress=function(e,t){if(G.isWebRTCSupported){var n=!0,r=!0;!function(e,t){if("undefined"==typeof document||"function"!=typeof document.getElementById)return;var n={},r=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!r){var i=document.getElementById("iframe");if(!i)return;var o=i.contentWindow;r=o.RTCPeerConnection||o.mozRTCPeerConnection||o.webkitRTCPeerConnection}if(!r)return;var a=null;"Chrome"===G.browser&&G.browser.version<58&&(a={optional:[{RtpDataChannels:!0}]});var s=new r({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},a);t&&(s.addStream?s.addStream(t):s.addTrack&&t.getTracks()[0]&&s.addTrack(t.getTracks()[0],t));function c(t){if(t){var r=E.exec(t);if(r){var i=r[1],o=t.match(P),a=!0;void 0===n[i]&&e(i,o,a),n[i]=!0}}else e()}if(s.onicecandidate=function(e){e.candidate&&e.candidate.candidate?c(e.candidate.candidate):c()},!t)try{s.createDataChannel("sctp",{})}catch(e){}G.isPromisesSupported?s.createOffer().then((function(e){s.setLocalDescription(e).then(d)})):s.createOffer((function(e){s.setLocalDescription(e,d,(function(){}))}),(function(){}));function d(){s.localDescription.sdp.split("\n").forEach((function(e){e&&0===e.indexOf("a=candidate:")&&c(e)}))}}((function(t){t?t.match(P)?e("Local: "+t,n=!1,r):t.match(x)?e("Public: "+t,n,r=!1):e("Public: "+t,n,r):e()}),t)}},G.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,G.isWebSocketsBlocked=!G.isWebSocketsSupported,"Nodejs"===G.osName&&(G.isWebSocketsSupported=!0,G.isWebSocketsBlocked=!1),G.checkWebSocketsSupport=function(e){e=e||function(){};try{var t,n=new WebSocket("wss://echo.websocket.org:443/");n.onopen=function(){G.isWebSocketsBlocked=!1,t=(new Date).getTime(),n.send("ping")},n.onmessage=function(){G.WebsocketLatency=(new Date).getTime()-t+"ms",e(),n.close(),n=null},n.onerror=function(){G.isWebSocketsBlocked=!0,e()}}catch(t){G.isWebSocketsBlocked=!0,e()}},G.load=function(e){B(e=e||function(){})},G.MediaDevices=void 0!==O?O:[],G.hasMicrophone=L,G.hasSpeakers=U,G.hasWebcam=N,G.isWebsiteHasWebcamPermissions=F,G.isWebsiteHasMicrophonePermissions=j,G.audioInputDevices=A,G.audioOutputDevices=D,G.videoInputDevices=I;var Q=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(Q=!0),G.isSetSinkIdSupported=Q;var Z=!1;G.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(Z=!0):G.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(Z=!0),G.isRTPSenderReplaceTracksSupported=Z;var ee=!1;G.browser.isFirefox&&G.browser.version>38&&(ee=!0),G.isRemoteStreamProcessingSupported=ee;var te=!1;void 0!==M&&"applyConstraints"in M.prototype&&(te=!0),G.isApplyConstraintsSupported=te;var ne=!1;G.browser.isFirefox&&G.browser.version>=43&&(ne=!0),G.isMultiMonitorScreenCapturingSupported=ne,G.isPromisesSupported=!!("Promise"in window),G.version="1.3.9",void 0===G&&(window.DetectRTC={});var re=window.MediaStream;void 0===re&&"undefined"!=typeof webkitMediaStream&&(re=webkitMediaStream),G.MediaStream=void 0!==re&&"function"==typeof re&&Object.keys(re.prototype),G.MediaStreamTrack=void 0!==M&&Object.keys(M.prototype);var ie=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;G.RTCPeerConnection=void 0!==ie&&Object.keys(ie.prototype),window.DetectRTC=G,e.exports=G,void 0===(r=function(){return G}.apply(t,[]))||(e.exports=r)}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,t,n){e.attachEvent&&e.attachEvent("on"+t,n)}),window.attachEventListener=function(e,t,n,r){e.addEventListener(t,n,r)};var C=window.MediaStream;function S(e,t){return(!e.session.audio||"two-way"!==e.session.audio)&&("Firefox"===DetectRTC.browser.name&&!1!==t||!("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50)&&(!0===o(t)||!(void 0!==t||!e.session.audio||!e.session.screen||e.session.video)&&(t=!0,!0)))}function b(e,t){return e&&e.getTracks?e.getTracks().filter((function(e){return e.kind===(t||"audio")})):[]}function T(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var t=new R;try{t.addTransceiver("audio"),e=!0}catch(e){}t.close()}catch(t){e=!1}return e&&function(){var e=!1;try{var t=new R({sdpSemantics:"unified-plan"});try{var n=t.getConfiguration();e="unified-plan"==n.sdpSemantics||(n.sdpSemantics,!1)}catch(t){e=!1}}catch(t){e=!1}return e}()}function w(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}void 0===C&&"undefined"!=typeof webkitMediaStream&&(C=webkitMediaStream),void 0!==C&&("stop"in C.prototype||(C.prototype.stop=function(){this.getTracks().forEach((function(e){e.stop()}))})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",w,!1),w();var R,k={};function P(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}void 0!==window.RTCPeerConnection?R=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?R=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(R=webkitRTCPeerConnection);var E=window.RTCSessionDescription||window.mozRTCSessionDescription,x=window.RTCIceCandidate||window.mozRTCIceCandidate,M=window.MediaStreamTrack;function O(e){if(void 0!==window.RTCPeerConnection?R=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?R=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(R=webkitRTCPeerConnection),E=window.RTCSessionDescription||window.mozRTCSessionDescription,x=window.RTCIceCandidate||window.mozRTCIceCandidate,M=window.MediaStreamTrack,!R)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var t=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:t.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){t.addStream(e,n.userid)},this.removeStream=function(e){t.removeStream(e,n.userid)};var n=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var r,i={};k.sdpConstraints=P({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var o=!!e.renegotiatingPeer;e.remoteSdp&&(o=!!e.remoteSdp.renegotiatingPeer);var a=[];if(t.attachStreams.forEach((function(e){e&&a.push(e)})),o)r=e.peerRef;else{var s="all";(t.candidates.turn||t.candidates.relay)&&(t.candidates.stun||t.candidates.reflexive||t.candidates.host||(s="relay"));try{var c={iceServers:t.iceServers,iceTransportPolicy:t.iceTransportPolicy||s};void 0!==t.iceCandidatePoolSize&&(c.iceCandidatePoolSize=t.iceCandidatePoolSize),void 0!==t.bundlePolicy&&(c.bundlePolicy=t.bundlePolicy),void 0!==t.rtcpMuxPolicy&&(c.rtcpMuxPolicy=t.rtcpMuxPolicy),t.sdpSemantics&&(c.sdpSemantics=t.sdpSemantics||"unified-plan"),t.iceServers&&t.iceServers.length||(c=null,t.optionalArgument=null),r=new R(c,t.optionalArgument)}catch(e){try{c={iceServers:t.iceServers};r=new R(c)}catch(e){r=new R}}}!r.getRemoteStreams&&r.getReceivers&&(r.getRemoteStreams=function(){var e=new C;return r.getReceivers().forEach((function(t){e.addTrack(t.track)})),[e]}),!r.getLocalStreams&&r.getSenders&&(r.getLocalStreams=function(){var e=new C;return r.getSenders().forEach((function(t){e.addTrack(t.track)})),[e]}),r.onicecandidate=function(i){if(i.candidate)t.trickleIce&&e.onLocalCandidate({candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex});else if(!t.trickleIce){var o=r.localDescription;e.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:f})}},a.forEach((function(i){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(i=t.beforeAddingStream(i,n))&&(r.getLocalStreams().forEach((function(e){i&&e.id==i.id&&(i=null)})),i&&i.getTracks&&i.getTracks().forEach((function(e){try{r.addTrack(e,i)}catch(e){}})))})),r.oniceconnectionstatechange=r.onsignalingstatechange=function(){var i=n.extra;t.peers[n.userid]&&(i=t.peers[n.userid].extra||i),r&&(e.onPeerStateChanged({iceConnectionState:r.iceConnectionState,iceGatheringState:r.iceGatheringState,signalingState:r.signalingState,extra:i,userid:n.userid}),r&&r.iceConnectionState&&-1!==r.iceConnectionState.search(/closed|failed/gi)&&n.streams instanceof Array&&n.streams.forEach((function(e){var n=t.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};t.onstreamended(n)})))};var d={OfferToReceiveAudio:!!a.length,OfferToReceiveVideo:!!a.length};e.localPeerSdpConstraints&&(d=e.localPeerSdpConstraints),k.sdpConstraints=P(d);var u={};r.ontrack=function(t){if(t&&"track"===t.type)if(t.stream=t.streams[t.streams.length-1],t.stream.id||(t.stream.id=t.track.id),u[t.stream.id]&&"Safari"!==DetectRTC.browser.name)t.track&&(t.track.onended=function(){r&&r.onremovestream(t)});else{u[t.stream.id]=t.stream.id;var n={};e.remoteSdp&&e.remoteSdp.streamsToShare?n=e.remoteSdp.streamsToShare:e.streamsToShare&&(n=e.streamsToShare);var o=n[t.stream.id];o?(t.stream.isAudio=o.isAudio,t.stream.isVideo=o.isVideo,t.stream.isScreen=o.isScreen):(t.stream.isVideo=!!b(t.stream,"video").length,t.stream.isAudio=!t.stream.isVideo,t.stream.isScreen=!1),t.stream.streamid=t.stream.id,i[t.stream.id]=t.stream,e.onRemoteStream(t.stream),t.stream.getTracks().forEach((function(e){e.onended=function(){r&&r.onremovestream(t)}})),t.stream.onremovetrack=function(){r&&r.onremovestream(t)}}},r.onremovestream=function(t){t.stream.streamid=t.stream.id,i[t.stream.id]&&delete i[t.stream.id],e.onRemoteStreamRemoved(t.stream)},"function"!=typeof r.removeStream&&(r.removeStream=function(e){e.getTracks().forEach((function(t){r.removeTrack(t,e)}))}),this.addRemoteCandidate=function(e){r.addIceCandidate(new x(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=t.processSdp(e.sdp)),r.setRemoteDescription(new E(e)).then(n,(function(r){t.enableLogs&&console.error("setRemoteDescription failed","\n",r,"\n",e.sdp),n()})).catch((function(r){t.enableLogs&&console.error("setRemoteDescription failed","\n",r,"\n",e.sdp),n()}))};var l=!0;function p(t){t.binaryType="arraybuffer",t.onmessage=function(t){e.onDataChannelMessage(t.data)},t.onopen=function(){e.onDataChannelOpened(t)},t.onerror=function(t){e.onDataChannelError(t)},t.onclose=function(t){e.onDataChannelClosed(t)},t.internalSend=t.send,t.send=function(e){"open"===t.readyState&&t.internalSend(e)},r.channel=t}e.remoteSdp&&(l=!1),this.createDataChannel=function(){p(r.createDataChannel("sctp",{}))},!0!==t.session.data||o||(l?this.createDataChannel():r.ondatachannel=function(e){p(e.channel)}),this.enableDisableVideoEncoding=function(e){var t;if(r.getSenders().forEach((function(e){t||"video"!==e.track.kind||(t=e)})),t&&t.getParameters){var n=t.getParameters();n.encodings[1]&&(n.encodings[1].active=!!e),n.encodings[2]&&(n.encodings[2].active=!!e),t.setParameters(n)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(d=e.remoteSdp.remotePeerSdpConstraints),k.sdpConstraints=P(d),this.addRemoteSdp(e.remoteSdp,(function(){m("createAnswer")}))),"two-way"!=t.session.audio&&"two-way"!=t.session.video&&"two-way"!=t.session.screen||(k.sdpConstraints=P({OfferToReceiveAudio:"two-way"==t.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==t.session.video||"two-way"==t.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var f={};function m(i){r[i](k.sdpConstraints).then((function(i){"Safari"!==DetectRTC.browser.name&&(i.sdp=t.processSdp(i.sdp)),r.setLocalDescription(i).then((function(){t.trickleIce&&(e.onLocalSdp({type:i.type,sdp:i.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:n.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:t?t.extra:{},streamsToShare:f}),t.onSettingLocalDescription(n))}),(function(e){t.enableLogs&&console.error("setLocalDescription error",e)}))}),(function(e){t.enableLogs&&console.error("sdp-error",e)}))}r.getLocalStreams().forEach((function(e){f[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}})),l&&m("createOffer"),r.nativeClose=r.close,r.close=function(){if(r){try{r.nativeClose!==r.close&&r.nativeClose()}catch(e){}r=null,n.peer=null}},this.peer=r}var A=function(){function e(e,r){var i=n(e);return i.videoCodecNumbers?"vp8"===r&&i.vp8LineNumber===i.videoCodecNumbers[0]||"vp9"===r&&i.vp9LineNumber===i.videoCodecNumbers[0]||"h264"===r&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=t(e,r,i):e}function t(e,t,n,r){var i="";if("vp8"===t){if(!n.vp8LineNumber)return e;i=n.vp8LineNumber}if("vp9"===t){if(!n.vp9LineNumber)return e;i=n.vp9LineNumber}if("h264"===t){if(!n.h264LineNumber)return e;i=n.h264LineNumber}var o=n.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",a=[i];return r&&(a=[]),n.videoCodecNumbers.forEach((function(e){e!==i&&a.push(e)})),o+=a.join(" "),e=e.replace(n.videoCodecNumbersOriginal,o)}function n(e){var t={};return e.split("\n").forEach((function(e){0===e.indexOf("m=video")&&(t.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach((function(n){(n=n.trim())&&n.length&&(t.videoCodecNumbers.push(n),t.videoCodecNumbersOriginal=e)}))),-1===e.indexOf("VP8/90000")||t.vp8LineNumber||(t.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||t.vp9LineNumber||(t.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||t.h264LineNumber||(t.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])})),t}function r(e,t,n){return function(e,t,n,r,i){for(var o=-1!==n?n:e.length,a=t;a<o;++a)if(0===e[a].indexOf(r)&&(!i||-1!==e[a].toLowerCase().indexOf(i.toLowerCase())))return a;return null}(e,0,-1,t,n)}function i(e){var t=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null}return{removeVPX:function(e){var r=n(e);return e=t(e,"vp9",r,!0),e=t(e,"vp8",r,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return e=(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,t){if(t&&t.getSenders&&t.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";t.getSenders().forEach((function(t){for(var n=t.getParameters(),r=0;r<n.codecs.length;r++)if(n.codecs[r].mimeType==e){n.codecs.unshift(n.codecs.splice(r,1));break}t.setParameters(n)}))}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,t,n){return function(e,t,n){return t?("undefined"!=typeof isFirefox&&isFirefox||(n&&(t.screen?t.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),t.screen&&n&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n")),(t.audio||t.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),t.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+t.audio+"\r\n")),t.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.screen+"\r\n"):t.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+t.video+"\r\n"))),e):e}(e,t,n)},setVideoBitrates:function(e,t){return function(e,t){var n,o=(t=t||{}).min,a=t.max,s=e.split("\r\n"),c=r(s,"a=rtpmap","VP8/90000");if(c&&(n=i(s[c])),!n)return e;var d,u=r(s,"a=rtpmap","rtx/90000");if(u&&(d=i(s[u])),!u)return e;var l=r(s,"a=fmtp:"+d.toString());if(null!==l){var p="\r\n";p+="a=fmtp:"+n+" x-google-min-bitrate="+(o||"228")+"; x-google-max-bitrate="+(a||"228"),s[l]=s[l].concat(p),e=s.join("\r\n")}return e}(e,t)},setOpusAttributes:function(e,t){return function(e,t){t=t||{};var n,o=e.split("\r\n"),a=r(o,"a=rtpmap","opus/48000");if(a&&(n=i(o[a])),!n)return e;var s=r(o,"a=fmtp:"+n.toString());if(null===s)return e;var c="";return c+="; stereo="+(void 0!==t.stereo?t.stereo:"1"),c+="; sprop-stereo="+(void 0!==t["sprop-stereo"]?t["sprop-stereo"]:"1"),void 0!==t.maxaveragebitrate&&(c+="; maxaveragebitrate="+(t.maxaveragebitrate||1048576)),void 0!==t.maxplaybackrate&&(c+="; maxplaybackrate="+(t.maxplaybackrate||1048576)),void 0!==t.cbr&&(c+="; cbr="+(void 0!==t.cbr?t.cbr:"1")),void 0!==t.useinbandfec&&(c+="; useinbandfec="+t.useinbandfec),void 0!==t.usedtx&&(c+="; usedtx="+t.usedtx),void 0!==t.maxptime&&(c+="\r\na=maxptime:"+t.maxptime),o[s]=o[s].concat(c),o.join("\r\n")}(e,t)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var t=e.split("\r\n"),n=null,r=0;r<t.length;r++)if(-1!==t[r].search("opus/48000")){var i=extractSdp(t[r],/:(\d+) opus\/48000/i);break}for(r=0;r<t.length;r++){if(-1!==t[r].search("a=fmtp"))if(extractSdp(t[r],/a=fmtp:(\d+)/)===i){n=r;break}}return null===n?e:(t[n]=t[n].concat("; stereo=1; sprop-stereo=1"),e=t.join("\r\n"))}}}();window.BandwidthHandler=A;var D={processCandidates:function(e,t){var n=t.candidate,r=e.candidates,i=r.stun,o=r.turn;if(y(r.reflexive)||(i=r.reflexive),y(r.relay)||(o=r.relay),(r.host||!n.match(/typ host/g))&&(o||!n.match(/typ relay/g))&&(i||!n.match(/typ srflx/g))){var a=e.iceProtocols;if((a.udp||!n.match(/ udp /g))&&(a.tcp||!n.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",n),{candidate:n,sdpMid:t.sdpMid,sdpMLineIndex:t.sdpMLineIndex}}}},I={getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}};function _(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])o(currentUserMediaRequest.streams[t].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,(function(e){e.streamid=e.streamid||e.id||f(),e.idInstance=t,o(e)}),(function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var n,r,i=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,(function(e){e(stream),n=stream}),(function(e){i(e),r=e})),{then:function(e){if(!n)return e,{then:function(e){r?e(r):i=e}};e(n)}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||f(),e.idInstance=t,o(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}));else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||f(),e.idInstance=t,o(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then((function(e){e.streamid=e.streamid||e.id||f(),e.idInstance=t,o(e)})).catch((function(t){e.onLocalMediaError(t,e.localMediaConstraints)}))}}else currentUserMediaRequest.queueRequests.push(e);function o(n,r){!function(e,t){e.mandatory&&e.mandatory.chromeMediaSource||e.mozMediaSource||e.mediaSource?t.isScreen=!0:e.video?t.isVideo=!0:e.audio&&(t.isAudio=!0)}(e.localMediaConstraints,n);var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,(function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=h(currentUserMediaRequest.queueRequests))}),!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&_(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,r)}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var t=this.streams[e];if(t){var n=(t=t.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(n)&&(delete this.queueRequests[this.queueRequests.indexOf(n)],this.queueRequests=h(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var L=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}function t(e,n,r,i){(i=(i||0)+1)>=n||setTimeout((function(){r(),t(e,n,r,i)}),e)}return{setHandlers:function(n,r,i){if(n&&n.addEventListener){if(void 0===r||1==r){var o="ended";"oninactive"in n&&(o="inactive"),n.addEventListener(o,(function(){L.onSyncNeeded(this.streamid,o)}),!1)}n.mute=function(t,o){t=e(t),void 0!==o&&(r=o),void 0!==t&&"audio"!=t||b(n,"audio").forEach((function(e){e.enabled=!1,i.streamEvents[n.streamid].isAudioMuted=!0})),void 0!==t&&"video"!=t||b(n,"video").forEach((function(e){e.enabled=!1})),void 0!==r&&1!=r||L.onSyncNeeded(n.streamid,"mute",t),i.streamEvents[n.streamid].muteType=t||"both",l(n,"mute",t)},n.unmute=function(o,a){o=e(o),void 0!==a&&(r=a),function(){if(!i.streamEvents[n.streamid].mediaElement)return;var e=i.streamEvents[n.streamid].mediaElement;e.volume=0,t(200,5,(function(){try{e.volume+=.2}catch(t){e.volume=1}}))}(),void 0!==o&&"audio"!=o||b(n,"audio").forEach((function(e){e.enabled=!0,i.streamEvents[n.streamid].isAudioMuted=!1})),void 0!==o&&"video"!=o||(b(n,"video").forEach((function(e){e.enabled=!0})),void 0!==o&&"video"==o&&i.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&i.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout((function(){e(t)}),50))}()),void 0!==r&&1!=r||L.onSyncNeeded(n.streamid,"unmute",o),i.streamEvents[n.streamid].unmuteType=o||"both",l(n,"unmute",o)}}},onSyncNeeded:function(e,t,n){}}}();function U(e){var t={};return{receive:function(n,r,i){var o=n.uuid;if(t[o]||(t[o]=[]),t[o].push(n.message),n.last){var a=t[o].join("");n.isobject&&(a=JSON.parse(a));var s={data:a,userid:r,extra:i,latency:(new Date).getTime()-n.sendingTime};e.autoTranslateText?(s.original=s.data,e.Translator.TranslateText(s.data,(function(t){s.data=t,e.onmessage(s)}))):e.onmessage(s),delete t[o]}}}}var N={send:function(e){var t=e.connection,n=e.channel,r=e.remoteUserId,i=e.text,o=t.chunkSize||1e3,a="",s=!1;"string"!=typeof i&&(s=!0,i=JSON.stringify(i));var c=f(),d=(new Date).getTime();!function e(i,u){var l={type:"text",uuid:c,sendingTime:d};i&&(u=i,l.packets=parseInt(u.length/o));u.length>o?l.message=u.slice(0,o):(l.message=u,l.last=!0,l.isobject=s);n.send(l,r),(a=u.slice(l.message.length)).length&&setTimeout((function(){e(null,a)}),t.chunkInterval||100)}(i)}},j={handle:function(e){var t={};e.onFileStart=function(n){var r=document.createElement("div");if(r.title=n.name,r.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(r.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(r,e.filesContainer.firstChild),!n.remoteUserId)return t[n.uuid]={div:r,progress:r.querySelector("progress"),label:r.querySelector("label")},void(t[n.uuid].progress.max=n.maxChunks);t[n.uuid]||(t[n.uuid]={}),t[n.uuid][n.remoteUserId]={div:r,progress:r.querySelector("progress"),label:r.querySelector("label")},t[n.uuid][n.remoteUserId].progress.max=n.maxChunks},e.onFileProgress=function(e){var n=t[e.uuid];n&&(e.remoteUserId&&!(n=t[e.uuid][e.remoteUserId])||(n.progress.value=e.currentPosition||e.maxChunks||n.progress.max,function(e,t){if(-1!==e.position){var n=+e.position.toFixed(2).split(".")[1]||100;t.innerHTML=n+"%"}}(n.progress,n.label)))},e.onFileEnd=function(e){var n=t[e.uuid];if(n){if(!e.remoteUserId||(n=t[e.uuid][e.remoteUserId])){var r=n.div;-1!=e.type.indexOf("image")?r.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':r.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else console.error("No such progress-helper element exist.",e)}}},F={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(t,n){var r=document.createElement("script");r.type="text/javascript";var i=encodeURIComponent(t),o="method"+e.token();window[o]=function(e){e.data&&e.data.translations[0]&&n?n(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e)};var a="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+o+"&q="+i;r.src=a,document.getElementsByTagName("head")[0].appendChild(r)},getListOfLanguages:function(t){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE){var e=JSON.parse(n.responseText);if(e&&e.data&&e.data.languages)return void t(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}};var r="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";n.open("GET",r,!0),n.send(null)}}}};!function(e){s=s||{useDefaultDevices:!0},e.channel=e.sessionid=(a||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var t=new u(e),n={};function r(t){if(e.socketAutoReConnect=!0,e.socket)t&&t(e.socket);else{if(void 0===d)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new d(e,(function(n){t&&t(e.socket)}))}}function i(n,r){e.socket.emit("join-room",{sessionid:e.sessionid,session:e.session,mediaConstraints:e.mediaConstraints,sdpConstraints:e.sdpConstraints,streams:l(),extra:e.extra,password:void 0!==e.password&&"object"!==o(e.password)?e.password:""},(function(i,o){if(!0===i){if(e.enableLogs&&console.log("isRoomJoined: ",i," roomid: ",e.sessionid),e.peers[e.sessionid])return;t.onNegotiationNeeded(n)}!1===i&&e.enableLogs&&console.warn("isRoomJoined: ",o," roomid: ",e.sessionid),r(i,e.sessionid,o)}))}function c(t){e.enableLogs&&console.log("Sending open-room signal to socket.io"),e.waitingForLocalMedia=!1,e.socket.emit("open-room",{sessionid:e.sessionid,session:e.session,mediaConstraints:e.mediaConstraints,sdpConstraints:e.sdpConstraints,streams:l(),extra:e.extra,identifier:e.publicRoomIdentifier,password:void 0!==e.password&&"object"!==o(e.password)?e.password:""},(function(n,r){!0===n&&(e.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",e.sessionid),t(n,e.sessionid)),!1===n&&(e.enableLogs&&console.warn("isRoomOpened: ",r," roomid: ",e.sessionid),t(n,e.sessionid,r))}))}function l(){try{return e.streamEvents.selectAll("local").map((function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}}))}catch(e){return[]}}function h(n,r){if(e.dontCaptureUserMedia||n.isDataOnly)r();else{var i={};n.localPeerSdpConstraints.OfferToReceiveAudio&&(i.audio=e.mediaConstraints.audio),n.localPeerSdpConstraints.OfferToReceiveVideo&&(i.video=e.mediaConstraints.video);var o=n.session||e.session;o.oneway&&"two-way"!==o.audio&&"two-way"!==o.video&&"two-way"!==o.screen?r():(o.oneway&&o.audio&&"two-way"===o.audio&&(o={audio:!0}),(o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:S(e)}).then((function(n){n.isScreen=!0,t.onGettingLocalMedia(n),!o.audio&&!o.video||S(e)?r(n):e.invokeGetUserMedia(null,r)}),(function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})):e.invokeGetUserMedia({audio:S(e),video:!0,isScreen:!0},!o.audio&&!o.video||S(e)?r:e.invokeGetUserMedia(null,r)):(o.audio||o.video)&&e.invokeGetUserMedia(null,r,o)))}}function y(t,n){t?(n.audio&&b(t,"audio").forEach((function(e){e.applyConstraints(n.audio)})),n.video&&b(t,"video").forEach((function(e){e.applyConstraints(n.video)}))):e.enableLogs&&console.error("No stream to applyConstraints.")}function w(n,r,i){r?t.replaceTrack(n,r,i):e.peers.getAllParticipants().forEach((function(e){t.replaceTrack(n,e,i)}))}t.onGettingLocalMedia=function(t,r){if(r=r||function(){},n[t.streamid])r();else{n[t.streamid]=!0;try{t.type="local"}catch(e){}e.setStreamEndHandler(t),m(t,(function(n){n.id=t.streamid,n.muted=!0,n.volume=0,-1===e.attachStreams.indexOf(t)&&e.attachStreams.push(t),void 0!==L&&L.setHandlers(t,!0,e);var i=0===t.getAudioTracks().filter((function(e){return e.enabled})).length;e.streamEvents[t.streamid]={stream:t,type:"local",mediaElement:n,userid:e.userid,extra:e.extra,streamid:t.streamid,isAudioMuted:i};try{!function(e,t){if(t.stream&&b(t.stream,"audio").length){if(!e||!t)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(t.stream,{onspeaking:function(){e.onspeaking(t)},onsilence:function(){e.onsilence(t)},onvolumechange:function(n,r){e.onvolumechange&&e.onvolumechange(merge({volume:n,threshold:r},t))}})}}}(e,e.streamEvents[t.streamid]),p(e,e.streamEvents[t.streamid]),e.onstream(e.streamEvents[t.streamid])}catch(e){}r()}),e)}},t.onGettingRemoteMedia=function(t,n){try{t.type="remote"}catch(e){}e.setStreamEndHandler(t,"remote-stream"),m(t,(function(r){r.id=t.streamid,void 0!==L&&L.setHandlers(t,!1,e),e.streamEvents[t.streamid]={stream:t,type:"remote",userid:n,extra:e.peers[n]?e.peers[n].extra:{},mediaElement:r,streamid:t.streamid},p(e,e.streamEvents[t.streamid]),e.onstream(e.streamEvents[t.streamid])}),e)},t.onRemovingRemoteMedia=function(t,n){var r=e.streamEvents[t.streamid];r||(r={stream:t,type:"remote",userid:n,extra:e.peers[n]?e.peers[n].extra:{},streamid:t.streamid,mediaElement:e.streamEvents[t.streamid]?e.streamEvents[t.streamid].mediaElement:null}),e.peersBackup[r.userid]&&(r.extra=e.peersBackup[r.userid].extra),e.onstreamended(r),delete e.streamEvents[t.streamid]},t.onNegotiationNeeded=function(t,n,i){i=i||function(){};var o={remoteUserId:n=n||t.remoteUserId,message:t=t||"",sender:e.userid};t.remoteUserId&&t.message&&t.sender&&(o=t),r((function(){e.socket.emit(e.socketMessageEvent,o,i)}))},t.onUserLeft=function(t){e.deletePeer(t)},t.disconnectWith=function(t,n){e.socket&&e.socket.emit("disconnect-with",t,n||function(){}),e.deletePeer(t)},e.socketOptions={transport:"polling"},e.openOrJoin=function(t,n){n=n||function(){},e.checkPresence(t,(function(t,r){if(t){e.sessionid=r;var o,a,s=!!e.session.oneway,d=g(e.session);a={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:s?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo};var u={remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:d,localPeerSdpConstraints:o,remotePeerSdpConstraints:a},sender:e.userid};h(u.message,(function(){i(u,n)}))}else e.waitingForLocalMedia=!0,e.isInitiator=!0,e.sessionid=r||e.sessionid,g(e.session)?c(n):e.captureUserMedia((function(){c(n)}))}))},e.waitingForLocalMedia=!1,e.open=function(t,n){n=n||function(){},e.waitingForLocalMedia=!0,e.isInitiator=!0,e.sessionid=t||e.sessionid,r((function(){g(e.session)?c(n):e.captureUserMedia((function(){c(n)}))}))},e.peersBackup={},e.deletePeer=function(t){if(t&&e.peers[t]){var n={userid:t,extra:e.peers[t]?e.peers[t].extra:{}};if(e.peersBackup[n.userid]&&(n.extra=e.peersBackup[n.userid].extra),e.onleave(n),e.peers[t]){e.peers[t].streams.forEach((function(e){e.stop()}));var r=e.peers[t].peer;if(r&&"closed"!==r.iceConnectionState)try{r.close()}catch(e){}e.peers[t]&&(e.peers[t].peer=null,delete e.peers[t])}}},e.rejoin=function(t){if(!e.isInitiator&&t&&Object.keys(t).length){var n={};e.peers[t.remoteUserId]&&(n=e.peers[t.remoteUserId].extra,e.deletePeer(t.remoteUserId)),t&&t.remoteUserId&&(e.join(t.remoteUserId),e.onReConnecting({userid:t.remoteUserId,extra:n}))}},e.join=function(t,n){e.sessionid=!!t&&(t.sessionid||t.remoteUserId||t)||e.sessionid,e.sessionid+="";var o=!1,a=!1,s=!1,c=!1;if(t&&t.session||!t||"string"==typeof t){var d=t&&t.session||e.session;s=!!d.oneway,c=g(d),a={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:s?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo}}var u=function(){};"function"==typeof(n=n||{})&&(u=n,n={}),void 0!==n.localPeerSdpConstraints&&(o=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(a=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(s=n.isOneWay),void 0!==n.isDataOnly&&(c=n.isDataOnly);var l={remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:c,localPeerSdpConstraints:o,remotePeerSdpConstraints:a},sender:e.userid};return h(l.message,(function(){r((function(){i(l,u)}))})),l},e.publicRoomIdentifier="",e.getUserMedia=e.captureUserMedia=function(n,r){n=n||function(){};var i=r||e.session;e.dontCaptureUserMedia||g(i)?n():(i.audio||i.video||i.screen)&&(i.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:S(e)}).then((function(o){if(o.isScreen=!0,t.onGettingLocalMedia(o),!i.audio&&!i.video||S(e))n(o);else{var a={};for(var s in i)"screen"!==s&&(a[s]=i[s]);e.invokeGetUserMedia(r,n,a)}}),(function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})):e.invokeGetUserMedia({audio:S(e),video:!0,isScreen:!0},(function(t){if(!i.audio&&!i.video||S(e))n(t);else{var o={};for(var a in i)"screen"!==a&&(o[a]=i[a]);e.invokeGetUserMedia(r,n,o)}})):(i.audio||i.video)&&e.invokeGetUserMedia(r,n,i))},e.onbeforeunload=function(n,r){e.closeBeforeUnload&&(e.peers.getAllParticipants().forEach((function(n){t.onNegotiationNeeded({userLeft:!0},n),e.peers[n]&&e.peers[n].peer&&e.peers[n].peer.close(),delete e.peers[n]})),r||e.closeSocket(),e.isInitiator=!1)},window.ignoreBeforeUnload?e.closeBeforeUnload=!1:(e.closeBeforeUnload=!0,window.addEventListener("beforeunload",e.onbeforeunload,!1)),e.userid=f(),e.changeUserId=function(t,n){n=n||function(){},e.userid=t||f(),e.socket.emit("changed-uuid",e.userid,n)},e.extra={},e.attachStreams=[],e.session={audio:!0,video:!0},e.enableFileSharing=!1,e.bandwidth={screen:!1,audio:!1,video:!1},e.codecs={audio:"opus",video:"VP9"},e.processSdp=function(t){return T()||"Safari"===DetectRTC.browser.name?t:("VP8"===e.codecs.video.toUpperCase()&&(t=A.preferCodec(t,"vp8")),"VP9"===e.codecs.video.toUpperCase()&&(t=A.preferCodec(t,"vp9")),"H264"===e.codecs.video.toUpperCase()&&(t=A.preferCodec(t,"h264")),"G722"===e.codecs.audio&&(t=A.removeNonG722(t)),"Firefox"===DetectRTC.browser.name||((e.bandwidth.video||e.bandwidth.screen)&&(t=A.setApplicationSpecificBandwidth(t,e.bandwidth,!!e.session.screen)),e.bandwidth.video&&(t=A.setVideoBitrates(t,{min:8*e.bandwidth.video*1024,max:8*e.bandwidth.video*1024})),e.bandwidth.audio&&(t=A.setOpusAttributes(t,{maxaveragebitrate:8*e.bandwidth.audio*1024,maxplaybackrate:8*e.bandwidth.audio*1024,stereo:1,maxptime:3}))),t)},void 0!==A&&(e.BandwidthHandler=e.CodecsHandler=A),e.mediaConstraints={audio:{mandatory:{},optional:e.bandwidth.audio?[{bandwidth:8*e.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:e.bandwidth.video?[{bandwidth:8*e.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(e.mediaConstraints={audio:!0,video:!0}),s.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load((function(){var t,n;if(DetectRTC.MediaDevices.forEach((function(r){"audioinput"===r.kind&&!1!==e.mediaConstraints.audio&&(t=r),"videoinput"===r.kind&&!1!==e.mediaConstraints.video&&(n=r)})),t){if("Firefox"===DetectRTC.browser.name)return void(!0!==e.mediaConstraints.audio?e.mediaConstraints.audio.deviceId=t.id:e.mediaConstraints.audio={deviceId:t.id});1==e.mediaConstraints.audio&&(e.mediaConstraints.audio={mandatory:{},optional:[]}),e.mediaConstraints.audio.optional||(e.mediaConstraints.audio.optional=[]);var r=[{sourceId:t.id}];e.mediaConstraints.audio.optional=r.concat(e.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0!==e.mediaConstraints.video?e.mediaConstraints.video.deviceId=n.id:e.mediaConstraints.video={deviceId:n.id});1==e.mediaConstraints.video&&(e.mediaConstraints.video={mandatory:{},optional:[]}),e.mediaConstraints.video.optional||(e.mediaConstraints.video.optional=[]);r=[{sourceId:n.id}];e.mediaConstraints.video.optional=r.concat(e.mediaConstraints.video.optional)}})),e.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},e.sdpSemantics=null,e.iceCandidatePoolSize=null,e.bundlePolicy=null,e.rtcpMuxPolicy=null,e.iceTransportPolicy=null,e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},e.iceServers=I.getIceServers(e),e.candidates={host:!0,stun:!0,turn:!0},e.iceProtocols={tcp:!0,udp:!0},e.onopen=function(t){e.enableLogs&&console.info("Data connection has been opened between you & ",t.userid)},e.onclose=function(t){e.enableLogs&&console.warn("Data connection has been closed between you & ",t.userid)},e.onerror=function(t){e.enableLogs&&console.error(t.userid,"data-error",t)},e.onmessage=function(t){e.enableLogs&&console.debug("data-message",t.userid,t.data)},e.send=function(t,n){e.peers.send(t,n)},e.close=e.disconnect=e.leave=function(){e.onbeforeunload(!1,!0)},e.closeEntireSession=function(t){t=t||function(){},e.socket.emit("close-entire-session",(function n(){e.getAllParticipants().length?setTimeout(n,100):(e.onEntireSessionClosed({sessionid:e.sessionid,userid:e.userid,extra:e.extra}),e.changeUserId(null,(function(){e.close(),t()})))}))},e.onEntireSessionClosed=function(t){e.enableLogs&&console.info("Entire session is closed: ",t.sessionid,t.extra)},e.onstream=function(t){var n=e.videosContainer;n.insertBefore(t.mediaElement,n.firstChild);var r=t.mediaElement.play();void 0===r?setTimeout((function(){t.mediaElement.play()}),2e3):r.catch((function(){})).then((function(){setTimeout((function(){t.mediaElement.play()}),2e3)}))},e.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},e.direction="many-to-many",e.removeStream=function(t,n){var r;e.attachStreams.forEach((function(e){e.id===t&&(r=e)})),r?(e.peers.getAllParticipants().forEach((function(t){if(!n||t===n){var i=e.peers[t];try{i.peer.removeStream(r)}catch(e){}}})),e.renegotiate()):console.warn("No such stream exist.",t)},e.addStream=function(n,r){if(n.getTracks)return-1===e.attachStreams.indexOf(n)&&(n.streamid||(n.streamid=n.id),e.attachStreams.push(n)),void e.renegotiate(r);function i(t){n.streamCallback&&n.streamCallback(t),e.renegotiate(r)}g(n)?e.renegotiate(r):(n.audio||n.video||n.screen)&&(n.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:S(e)}).then((function(r){r.isScreen=!0,t.onGettingLocalMedia(r),!n.audio&&!n.video||S(e)?i(r):e.invokeGetUserMedia(null,(function(e){i(e)}))}),(function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})):e.invokeGetUserMedia({audio:S(e),video:!0,isScreen:!0},(function(t){!n.audio&&!n.video||S(e)?i(t):e.invokeGetUserMedia(null,(function(e){i(e)}))})):(n.audio||n.video)&&e.invokeGetUserMedia(null,i))},e.invokeGetUserMedia=function(n,r,i){i||(i=e.session),n||(n=e.mediaConstraints),_({onGettingLocalMedia:function(e){var i=n.video;i&&(i.mediaSource||i.mozMediaSource||i.mandatory&&i.mandatory.chromeMediaSource)&&(e.isScreen=!0),e.isScreen||(e.isVideo=!!b(e,"video").length,e.isAudio=!e.isVideo&&b(e,"audio").length),t.onGettingLocalMedia(e,(function(){"function"==typeof r&&r(e)}))},onLocalMediaError:function(e,n){t.onLocalMediaError(e,n)},localMediaConstraints:n||{audio:!!i.audio&&n.audio,video:!!i.video&&n.video}})},e.applyConstraints=function(t,n){if(M&&M.prototype.applyConstraints){var r;if(n)return e.streamEvents[n]&&(r=e.streamEvents[n].stream),void y(r,t);e.attachStreams.forEach((function(e){y(e,t)}))}else alert("track.applyConstraints is NOT supported in your browser.")},e.replaceTrack=function(n,r,i){if(n=n||{},R.prototype.getSenders)if(n instanceof M)w(n,r,i);else{if(n instanceof C)return b(n,"video").length&&w(b(n,"video")[0],r,!0),void(b(n,"audio").length&&w(b(n,"audio")[0],r,!1));if(g(n))throw"connection.replaceTrack requires audio and/or video and/or screen.";(n.audio||n.video||n.screen)&&(n.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:S(e)}).then((function(r){r.isScreen=!0,t.onGettingLocalMedia(r),!n.audio&&!n.video||S(e)?o(r):e.invokeGetUserMedia(null,o)}),(function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")})):e.invokeGetUserMedia({audio:S(e),video:!0,isScreen:!0},!n.audio&&!n.video||S(e)?o:e.invokeGetUserMedia(null,o)):(n.audio||n.video)&&e.invokeGetUserMedia(null,o))}else e.addStream(n);function o(t){e.replaceTrack(t,r,i||n.video||n.screen)}},e.resetTrack=function(t,n){t||(t=e.getAllParticipants()),"string"==typeof t&&(t=[t]),t.forEach((function(t){var r=e.peers[t].peer;void 0!==n&&!0!==n||!r.lastVideoTrack||e.replaceTrack(r.lastVideoTrack,t,!0),void 0!==n&&!1!==n||!r.lastAudioTrack||e.replaceTrack(r.lastAudioTrack,t,!1)}))},e.renegotiate=function(n){n?t.renegotiatePeer(n):e.peers.getAllParticipants().forEach((function(e){t.renegotiatePeer(e)}))},e.setStreamEndHandler=function(t,n){if(t&&t.addEventListener&&(n=!!n,!t.alreadySetEndHandler)){t.alreadySetEndHandler=!0;var r="ended";"oninactive"in t&&(r="inactive"),t.addEventListener(r,(function(){if(t.idInstance&&currentUserMediaRequest.remove(t.idInstance),!n){var r=[];e.attachStreams.forEach((function(e){e.id!=t.id&&r.push(e)})),e.attachStreams=r}var i=e.streamEvents[t.streamid];if(i||(i={stream:t,streamid:t.streamid,type:n?"remote":"local",userid:e.userid,extra:e.extra,mediaElement:e.streamEvents[t.streamid]?e.streamEvents[t.streamid].mediaElement:null}),n&&e.peers[i.userid]){var o=e.peers[i.userid].peer;r=[];o.getRemoteStreams().forEach((function(e){e.id!=t.id&&r.push(e)})),e.peers[i.userid].streams=r}i.userid===e.userid&&"remote"===i.type||(e.peersBackup[i.userid]&&(i.extra=e.peersBackup[i.userid].extra),e.onstreamended(i),delete e.streamEvents[t.streamid])}),!1)}},e.onMediaError=function(t,n){e.enableLogs&&console.error(t,n)},e.autoCloseEntireSession=!1,e.filesContainer=e.videosContainer=document.body||document.documentElement,e.isInitiator=!1,e.shareFile=t.shareFile,void 0!==j&&j.handle(e),void 0!==F&&F.handle(e),e.token=f,e.onNewParticipant=function(t,n){e.acceptParticipationRequest(t,n)},e.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),t.createNewPeer(e,n)},void 0!==L&&(e.StreamsHandler=L),e.onleave=function(e){},e.invokeSelectFileDialog=function(e){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(e)},e.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var t=e.mediaElement.pause();void 0!==t?t.then((function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"})):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},e.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},e.onExtraDataUpdated=function(t){t.status="online",e.onUserStatusChanged(t,!0)},e.getAllParticipants=function(t){return e.peers.getAllParticipants(t)},void 0!==L&&(L.onSyncNeeded=function(n,r,i){e.peers.getAllParticipants().forEach((function(e){t.onNegotiationNeeded({streamid:n,action:r,streamSyncNeeded:!0,type:i||"both"},e)}))}),e.connectSocket=function(e){r(e)},e.closeSocket=function(){try{io.sockets={}}catch(e){}e.socket&&("function"==typeof e.socket.disconnect&&e.socket.disconnect(),"function"==typeof e.socket.resetProps&&e.socket.resetProps(),e.socket=null)},e.getSocket=function(t){return!t&&e.enableLogs&&console.warn("getSocket.callback paramter is required."),t=t||function(){},e.socket?t(e.socket):r((function(){t(e.socket)})),e.socket},e.getRemoteStreams=t.getRemoteStreams;var k=["selectFirst","selectAll","forEach"];if(e.streamEvents={selectFirst:function(t){return e.streamEvents.selectAll(t)[0]},selectAll:function(t){t||(t={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==t&&(t={local:!0}),"remote"==t&&(t={remote:!0}),"screen"==t&&(t={isScreen:!0}),"audio"==t&&(t={isAudio:!0}),"video"==t&&(t={isVideo:!0});var n=[];return Object.keys(e.streamEvents).forEach((function(r){var i=e.streamEvents[r];if(-1===k.indexOf(r)){var o=!0;t.local&&"local"===i.type&&(o=!1),t.remote&&"remote"===i.type&&(o=!1),t.isScreen&&i.stream.isScreen&&(o=!1),t.isVideo&&i.stream.isVideo&&(o=!1),t.isAudio&&i.stream.isAudio&&(o=!1),t.userid&&i.userid===t.userid&&(o=!1),!1===o&&n.push(i)}})),n}},e.socketURL="/",e.socketMessageEvent="RTCMultiConnection-Message",e.socketCustomEvent="RTCMultiConnection-Custom-Message",e.DetectRTC=DetectRTC,e.setCustomSocketEvent=function(t){t&&(e.socketCustomEvent=t),e.socket&&e.socket.emit("set-custom-socket-event-listener",e.socketCustomEvent)},e.getNumberOfBroadcastViewers=function(t,n){e.socket&&t&&n&&e.socket.emit("get-number-of-users-in-specific-broadcast",t,n)},e.onNumberOfBroadcastViewersUpdated=function(t){e.enableLogs&&e.isInitiator&&console.info("Number of broadcast (",t.broadcastId,") viewers",t.numberOfBroadcastViewers)},e.onUserStatusChanged=function(t,n){e.enableLogs&&!n&&console.info(t.userid,t.status)},e.getUserMediaHandler=_,e.multiPeersHandler=t,e.enableLogs=!0,e.setCustomSocketHandler=function(e){void 0!==d&&(d=e)},e.chunkSize=4e4,e.maxParticipantsAllowed=1e3,e.disconnectWith=t.disconnectWith,e.checkPresence=function(t,n){t=t||e.sessionid,"SSEConnection"!==d.name?e.socket?e.socket.emit("check-presence",t+"",(function(t,r,i){e.enableLogs&&console.log("checkPresence.isRoomExist: ",t," roomid: ",r),n(t,r,i)})):e.connectSocket((function(){e.checkPresence(t,n)})):SSEConnection.checkPresence(t,(function(t,r,i){if(!e.socket)return t||(e.userid=r),void e.connectSocket((function(){n(t,r,i)}));n(t,r)}))},e.onReadyForOffer=function(t,n){e.multiPeersHandler.createNewPeer(t,n)},e.setUserPreferences=function(t){return e.dontAttachStream&&(t.dontAttachLocalStream=!0),e.dontGetRemoteStream&&(t.dontGetRemoteStream=!0),t},e.updateExtraData=function(){e.socket.emit("extra-data-updated",e.extra)},e.enableScalableBroadcast=!1,e.maxRelayLimitPerUser=3,e.dontCaptureUserMedia=!1,e.dontAttachStream=!1,e.dontGetRemoteStream=!1,e.onReConnecting=function(t){e.enableLogs&&console.info("ReConnecting with",t.userid,"...")},e.beforeAddingStream=function(e){return e},e.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(e.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(e.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(e.getChromeExtensionStatus=getChromeExtensionStatus),e.modifyScreenConstraints=function(e){return e},e.onPeerStateChanged=function(t){e.enableLogs&&-1!==t.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",t.userid,t.extra,"state:",t.iceConnectionState)},e.isOnline=!0,v("online",(function(){e.isOnline=!0})),v("offline",(function(){e.isOnline=!1})),e.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(e.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),e.isLowBandwidth)){if(e.bandwidth={audio:!1,video:!1,screen:!1},e.mediaConstraints.audio&&e.mediaConstraints.audio.optional&&e.mediaConstraints.audio.optional.length){var P=[];e.mediaConstraints.audio.optional.forEach((function(e){void 0===e.bandwidth&&P.push(e)})),e.mediaConstraints.audio.optional=P}if(e.mediaConstraints.video&&e.mediaConstraints.video.optional&&e.mediaConstraints.video.optional.length){P=[];e.mediaConstraints.video.optional.forEach((function(e){void 0===e.bandwidth&&P.push(e)})),e.mediaConstraints.video.optional=P}}e.getExtraData=function(t,n){if(!t)throw"remoteUserId is required.";if("function"!=typeof n)return e.peers[t]?e.peers[t].extra:e.peersBackup[t]?e.peersBackup[t].extra:{};e.socket.emit("get-remote-user-extra-data",t,(function(e,t,r){n(e,t,r)}))},s.autoOpenOrJoin&&e.openOrJoin(e.sessionid),e.onUserIdAlreadyTaken=function(t,n){e.close(),e.closeSocket(),e.isInitiator=!1,e.userid=e.token(),e.join(e.sessionid),e.enableLogs&&console.warn("Userid already taken.",t,"Your new userid:",e.userid)},e.trickleIce=!0,e.version="3.7.0",e.onSettingLocalDescription=function(t){e.enableLogs&&console.info("Set local description for remote user",t.userid)},e.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},e.autoCreateMediaElement=!0,e.password=null,e.setPassword=function(t,n){n=n||function(){},e.socket?e.socket.emit("set-password",t,n):(e.password=t,n(!0,e.sessionid,null))},e.onSocketDisconnect=function(t){e.enableLogs&&console.warn("socket.io connection is closed")},e.onSocketError=function(t){e.enableLogs&&console.warn("socket.io connection is failed")},e.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};e.exports=t=a,void 0===(r=function(){return a}.apply(t,[]))||(e.exports=r)},89306:(e,t,n)=>{"use strict";var r=n(48764).Buffer;!function(){function e(){this.readAsArrayBuffer=function(e,t){var n=t.earlyCallback;delete t.earlyCallback,function(e,t){t=t||function(e){postMessage(e)};var n=e.file;n.uuid||(n.uuid=(100*Math.random()).toString().replace(/\./g,""));var r=e.chunkSize||15e3;e.extra&&e.extra.chunkSize&&(r=e.extra.chunkSize);var i,o=0,a=r,s=Math.floor(Math.min(1e8,a)/r)*r,c=Math.ceil(n.size/r);n.maxChunks=c;var d=0,u=[];t({currentPosition:d,uuid:n.uuid,maxChunks:c,size:n.size,name:n.name,type:n.type,lastModifiedDate:(n.lastModifiedDate||new Date).toString(),start:!0});var l,p=new FileReader;function f(e,o,a){i=Math.ceil(o.byteLength/r);for(var s=0;s<i;s++){var l=s*r;u[d]=o.slice(l,Math.min(l+r,o.byteLength)),t({uuid:n.uuid,buffer:u[d],currentPosition:d,maxChunks:c,size:n.size,name:n.name,lastModifiedDate:(n.lastModifiedDate||new Date).toString(),type:n.type}),d++}d==c&&!0,a()}p.onloadend=function(e){e.target.readyState==FileReader.DONE&&f(n.name,e.target.result,(function(){(++o+1)*s<n.size?(l=n.slice(o*s,(o+1)*s),p.readAsArrayBuffer(l)):o*s<n.size?(l=n.slice(o*s,n.size),p.readAsArrayBuffer(l)):(n.url=URL.createObjectURL(n),t({currentPosition:d,uuid:n.uuid,maxChunks:c,size:n.size,name:n.name,lastModifiedDate:(n.lastModifiedDate||new Date).toString(),url:URL.createObjectURL(n),type:n.type,end:!0}))}))},d+=1,l=n.slice(o*s,(o+1)*s),p.readAsArrayBuffer(l)}(t,(function(r){e.chunks[r.uuid]||(e.chunks[r.uuid]={currentPosition:-1}),t.extra=t.extra||{userid:0},r.userid=t.userid||t.extra.userid||0,r.extra=t.extra,e.chunks[r.uuid][r.currentPosition]=r,r.end&&n&&(n(r.uuid),n=null),r.maxChunks>200&&200==r.currentPosition&&n&&(n(r.uuid),n=null)}))}}function t(e){var t=this;t.chunks={},t.chunksWaiters={},t.receive=function n(r,i){if(r.uuid){if(r.start&&!t.chunks[r.uuid]&&(t.chunks[r.uuid]={},e.onBegin&&e.onBegin(r)),!r.end&&r.buffer&&(t.chunks[r.uuid][r.currentPosition]=r.buffer),r.end){var o=t.chunks[r.uuid],a=[];Object.keys(o).forEach((function(e,t){a.push(o[e])}));var s=new Blob(a,{type:r.type});(s=function(e,t){e||(e={});if(!t)return e;for(var n in t)try{e[n]=t[n]}catch(e){}return e}(s,r)).url=URL.createObjectURL(s),s.uuid=r.uuid,s.size||console.error("Something went wrong. Blob Size is 0."),e.onEnd&&e.onEnd(s),delete t.chunks[r.uuid],delete t.chunksWaiters[r.uuid]}r.buffer&&e.onProgress&&e.onProgress(r),r.end||(i(r),t.chunksWaiters[r.uuid]=function(){setTimeout((function e(){r.buffer&&t.chunks[r.uuid]&&(r.currentPosition==r.maxChunks||t.chunks[r.uuid][r.currentPosition]||(i(r),setTimeout(e,5e3)))}),5e3)},t.chunksWaiters[r.uuid]())}else e.convertToObject(r,(function(e){n(e)}))}}var n={ConvertToArrayBuffer:function(e,t){h.pack(e,(function(e){t(e.buffer)}))},ConvertToObject:function(e,t){h.unpack(e,t)}};var i=!1,o=!1,a=Uint8Array.BYTES_PER_ELEMENT,s=Uint16Array.BYTES_PER_ELEMENT,c=Uint32Array.BYTES_PER_ELEMENT,d={NULL:0,UNDEFINED:1,STRING:2,NUMBER:3,BOOLEAN:4,ARRAY:5,OBJECT:6,INT8ARRAY:7,INT16ARRAY:8,INT32ARRAY:9,UINT8ARRAY:10,UINT16ARRAY:11,UINT32ARRAY:12,FLOAT32ARRAY:13,FLOAT64ARRAY:14,ARRAYBUFFER:15,BLOB:16,FILE:16,BUFFER:17},u=[null,null,"Uint16","Float64","Uint8",null,null,"Int8","Int16","Int32","Uint8","Uint16","Uint32","Float32","Float64","Uint8","Uint8","Uint8"],l=function(e){var t=0,n=0,r=0,l=o,p=new ArrayBuffer(e[0].byte_length+e[0].header_size),f=new DataView(p);for(n=0;n<e.length;n++){e[n].header_size;var m=e[n].type,v=e[n].length,h=e[n].value,g=e[n].byte_length,y=u[m],C=null===y?0:window[y+"Array"].BYTES_PER_ELEMENT;switch(m===d.BUFFER?f.setUint8(t,d.BLOB,l):f.setUint8(t,m,l),t+=a,m!==d.ARRAY&&m!==d.OBJECT||(f.setUint16(t,v,l),t+=s),f.setUint32(t,g,l),t+=c,m){case d.NULL:case d.UNDEFINED:break;case d.STRING:for(r=0;r<v;r++,t+=C)f.setUint16(t,h.charCodeAt(r),l);break;case d.NUMBER:case d.BOOLEAN:i,f["set"+y](t,h,l),t+=C;break;case d.INT8ARRAY:case d.INT16ARRAY:case d.INT32ARRAY:case d.UINT8ARRAY:case d.UINT16ARRAY:case d.UINT32ARRAY:case d.FLOAT32ARRAY:case d.FLOAT64ARRAY:new Uint8Array(f.buffer,t,g).set(new Uint8Array(h.buffer)),t+=g;break;case d.ARRAYBUFFER:case d.BUFFER:new Uint8Array(f.buffer,t,g).set(new Uint8Array(h)),t+=g;break;case d.BLOB:case d.ARRAY:case d.OBJECT:break;default:throw"TypeError: Unexpected type found."}i}return f},p=function(e,t){var n,l,f,m,v,h=0,g=o;n=e.getUint8(t,g),t+=a,n!==d.ARRAY&&n!==d.OBJECT||(l=e.getUint16(t,g),t+=s),f=e.getUint32(t,g),t+=c;var y=u[n],C=null===y?0:window[y+"Array"].BYTES_PER_ELEMENT;switch(n){case d.NULL:case d.UNDEFINED:i,m=null;break;case d.STRING:l=f/C;var S=[];for(h=0;h<l;h++){var b=e.getUint16(t,g);t+=C,S.push(String.fromCharCode(b))}m=S.join("");break;case d.NUMBER:m=e.getFloat64(t,g),t+=C;break;case d.BOOLEAN:m=1===e.getUint8(t,g),t+=C;break;case d.INT8ARRAY:case d.INT16ARRAY:case d.INT32ARRAY:case d.UINT8ARRAY:case d.UINT16ARRAY:case d.UINT32ARRAY:case d.FLOAT32ARRAY:case d.FLOAT64ARRAY:case d.ARRAYBUFFER:v=e.buffer.slice(t,t+f),t+=f,m=n===d.ARRAYBUFFER?v:new window[y+"Array"](v);break;case d.BLOB:if(window.Blob){var T=p(e,t),w=p(e,T.cursor);t=w.cursor,m=new Blob([w.value],{type:T.value})}else v=e.buffer.slice(t,t+f),t+=f,m=new r(v);break;case d.ARRAY:for(m=[],h=0;h<l;h++)t=(v=p(e,t)).cursor,m.push(v.value);break;case d.OBJECT:for(m={},h=0;h<l;h++){var R=p(e,t),k=p(e,R.cursor);t=k.cursor,m[R.value]=k.value}break;default:throw"TypeError: Type not supported."}return{value:m,cursor:t}},f=function(e,t){for(var n=e.length,r=[],i=0,o=0,a=0;a<e.length;a++)!function(a){m(e[a],(function(e){if(r[a]=e,o+=e[0].header_size+e[0].byte_length,++i===n){for(var s=[],c=0;c<r.length;c++)s=s.concat(r[c]);t(s,o)}}))}(a)},m=function(e,t){var n,i,o=a+c,l=0,p=0,m=e;switch(i=function(e){var t=void 0;if(void 0===e)t=d.UNDEFINED;else if(null===e)t=d.NULL;else{var n=e.constructor.name,i=e.constructor.toString().match(/\w+/g)[1];if(void 0!==n&&void 0!==d[n.toUpperCase()])t=d[n.toUpperCase()];else if(void 0!==i&&void 0!==d[i.toUpperCase()])t=d[i.toUpperCase()];else switch(typeof e){case"string":t=d.STRING;break;case"number":t=d.NUMBER;break;case"boolean":t=d.BOOLEAN;break;case"object":e instanceof Array?t=d.ARRAY:e instanceof Int8Array?t=d.INT8ARRAY:e instanceof Int16Array?t=d.INT16ARRAY:e instanceof Int32Array?t=d.INT32ARRAY:e instanceof Uint8Array?t=d.UINT8ARRAY:e instanceof Uint16Array?t=d.UINT16ARRAY:e instanceof Uint32Array?t=d.UINT32ARRAY:e instanceof Float32Array?t=d.FLOAT32ARRAY:e instanceof Float64Array?t=d.FLOAT64ARRAY:e instanceof ArrayBuffer?t=d.ARRAYBUFFER:e instanceof Blob?t=d.BLOB:e instanceof r?t=d.BUFFER:e instanceof Object&&(t=d.OBJECT)}}return t}(e),n=null==u[i]?0:window[u[i]+"Array"].BYTES_PER_ELEMENT,i){case d.UNDEFINED:case d.NULL:break;case d.NUMBER:case d.BOOLEAN:l=n;break;case d.STRING:case d.INT8ARRAY:case d.INT16ARRAY:case d.INT32ARRAY:case d.UINT8ARRAY:case d.UINT16ARRAY:case d.UINT32ARRAY:case d.FLOAT32ARRAY:case d.FLOAT64ARRAY:l+=(p=e.length)*n;break;case d.ARRAY:return void f(e,(function(n,r){t([{type:i,length:e.length,header_size:o+s,byte_length:r,value:null}].concat(n))}));case d.OBJECT:var v=[];for(var h in e)e.hasOwnProperty(h)&&(v.push(h),v.push(e[h]),p++);return void f(v,(function(e,n){t([{type:i,length:p,header_size:o+s,byte_length:n,value:null}].concat(e))}));case d.ARRAYBUFFER:l+=e.byteLength;break;case d.BLOB:var g=e.type,y=new FileReader;return y.onload=function(e){f([g,e.target.result],(function(e,n){t([{type:i,length:p,header_size:o,byte_length:n,value:null}].concat(e))}))},y.onerror=function(e){throw"FileReader Error: "+e},void y.readAsArrayBuffer(e);case d.BUFFER:l+=e.length;break;default:throw'TypeError: Type "'+e.constructor.name+'" not supported.'}t([{type:i,length:p,header_size:o,byte_length:l,value:m}].concat([]))},v=function(e,t){var n=e instanceof DataView?e:new DataView(e);return p(n,0).value};var h={pack:function(e,t){try{i,m(e,(function(e){t(l(e))}))}catch(e){throw e}},unpack:function(e,t){try{i;var n=v(e);i,t(n)}catch(e){throw e}}};window.FileConverter=n,window.FileSelector=function(){var e=this,t=function(){};function n(n,r,i){n=n||function(){};var o=document.createElement("input");o.type="file",r&&(o.multiple=!0),i&&(o.webkitdirectory=!0),o.accept=e.accept,o.onclick=function(){o.clickStarted=!0},document.body.onfocus=function(){setTimeout((function(){o.clickStarted&&(o.clickStarted=!1,o.value||t())}),500)},o.onchange=function(){if(r){if(!o.files.length)return void console.error("No file selected.");var e=[];return Array.from(o.files).forEach((function(t){t.url=t.webkitRelativePath,e.push(t)})),void n(e)}o.files[0]?(n(o.files[0]),o.parentNode.removeChild(o)):console.error("No file selected.")},o.style.display="none",(document.body||document.documentElement).appendChild(o),function(e){if("function"==typeof e.click)return void e.click();if("function"==typeof e.change)return void e.change();if(void 0!==document.createEvent("Event")){if("function"==typeof(t=document.createEvent("Event")).initEvent&&"function"==typeof e.dispatchEvent)return t.initEvent("click",!0,!0),void e.dispatchEvent(t)}var t=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(t)}(o)}e.selectSingleFile=function(e,r){r&&(t=r),n(e)},e.selectMultipleFiles=function(e,r){r&&(t=r),n(e,!0)},e.selectDirectory=function(e,r){r&&(t=r),n(e,!0,!0)},e.accept="*.*"},window.FileBufferReader=function(){var r=this,i=new e;r.chunks={},r.users={},r.readAsArrayBuffer=function(e,t,n){var o={file:e,earlyCallback:function(e){t(a(e,{currentPosition:-1}))},extra:n||{userid:0}};e.extra&&Object.keys(e.extra).length&&Object.keys(e.extra).forEach((function(t){o.extra[t]=e.extra[t]})),i.readAsArrayBuffer(r,o)},r.getNextChunk=function(e,t,n){var i;void 0!==e.currentPosition&&(i=e.currentPosition,e=e.uuid);var o=r.chunks[e];if(o){void 0!==n?(r.users[n+""]||(r.users[n+""]={fileUUID:e,userid:n,currentPosition:-1}),void 0!==i&&(r.users[n+""].currentPosition=i),r.users[n+""].currentPosition++,i=r.users[n+""].currentPosition):(void 0!==i&&(r.chunks[e].currentPosition=i),r.chunks[e].currentPosition++,i=r.chunks[e].currentPosition);var s=o[i];if(!s)return delete r.chunks[e],void r.convertToArrayBuffer({chunkMissing:!0,currentPosition:i,uuid:e},t);s=a(s),void 0!==n&&(s.remoteUserId=n+""),s.start&&r.onBegin(s),s.end&&r.onEnd(s),r.onProgress(s),r.convertToArrayBuffer(s,(function(e){s.currentPosition!=s.maxChunks?t(e,!1):t(e,!0)}))}};var o=new t(r);function a(e,t){if(null==e||"object"!=typeof e)return e;if(e.constructor!=Object&&e.constructor!=Array)return e;if(e.constructor==Date||e.constructor==RegExp||e.constructor==Function||e.constructor==String||e.constructor==Number||e.constructor==Boolean)return new e.constructor(e);for(var n in t=t||new e.constructor,e)t[n]=void 0===t[n]?a(e[n],null):t[n];return t}r.addChunk=function(e,t){e&&o.receive(e,(function(e){r.convertToArrayBuffer({readyForNextChunk:!0,currentPosition:e.currentPosition,uuid:e.uuid},t)}))},r.chunkMissing=function(e){delete o.chunks[e.uuid],delete o.chunksWaiters[e.uuid]},r.onBegin=function(){},r.onEnd=function(){},r.onProgress=function(){},r.convertToObject=n.ConvertToObject,r.convertToArrayBuffer=n.ConvertToArrayBuffer,r.setMultipleUsers=function(){}}}()},11082:e=>{var t;t=function(){return function(e,t,n){function r(n,o){if(!t[n]){if(!e[n]){if(i)return i(n,!0);throw new Error("Cannot find module '"+n+"'")}var a=t[n]={exports:{}};e[n][0].call(a.exports,(function(t){var i=e[n][1][t];return r(i||t)}),a,a.exports)}return t[n].exports}for(var i=void 0,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(e,t,n){var r,i=e("wildemitter");"undefined"!=typeof window&&(r=window.AudioContext||window.webkitAudioContext);var o=null;t.exports=function(e,t){var n=new i;if(!r)return n;var a,s,c,d=(t=t||{}).smoothing||.1,u=t.interval||50,l=t.threshold,p=t.play,f=t.history||10,m=!0;o=t.audioContext||o||new r,(c=o.createAnalyser()).fftSize=512,c.smoothingTimeConstant=d,s=new Float32Array(c.frequencyBinCount),e.jquery&&(e=e[0]),e instanceof HTMLAudioElement||e instanceof HTMLVideoElement?(a=o.createMediaElementSource(e),void 0===p&&(p=!0),l=l||-50):(a=o.createMediaStreamSource(e),l=l||-50),a.connect(c),p&&c.connect(o.destination),n.speaking=!1,n.suspend=function(){return o.suspend()},n.resume=function(){return o.resume()},Object.defineProperty(n,"state",{get:function(){return o.state}}),o.onstatechange=function(){n.emit("state_change",o.state)},n.setThreshold=function(e){l=e},n.setInterval=function(e){u=e},n.stop=function(){m=!1,n.emit("volume_change",-100,l),n.speaking&&(n.speaking=!1,n.emit("stopped_speaking")),c.disconnect(),a.disconnect()},n.speakingHistory=[];for(var v=0;v<f;v++)n.speakingHistory.push(0);var h=function(){setTimeout((function(){if(m){var e=function(e,t){var n=-1/0;e.getFloatFrequencyData(t);for(var r=4,i=t.length;r<i;r++)t[r]>n&&t[r]<0&&(n=t[r]);return n}(c,s);n.emit("volume_change",e,l);var t=0;if(e>l&&!n.speaking){for(var r=n.speakingHistory.length-3;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];t>=2&&(n.speaking=!0,n.emit("speaking"))}else if(e<l&&n.speaking){for(r=0;r<n.speakingHistory.length;r++)t+=n.speakingHistory[r];0==t&&(n.speaking=!1,n.emit("stopped_speaking"))}n.speakingHistory.shift(),n.speakingHistory.push(0+(e>l)),h()}}),u)};return h(),n}},{wildemitter:2}],2:[function(e,t,n){function r(){}t.exports=r,r.mixin=function(e){var t=e.prototype||e;t.isWildEmitter=!0,t.on=function(e,t,n){this.callbacks=this.callbacks||{};var r=3===arguments.length,i=r?arguments[1]:void 0,o=r?arguments[2]:arguments[1];return o._groupName=i,(this.callbacks[e]=this.callbacks[e]||[]).push(o),this},t.once=function(e,t,n){var r=this,i=3===arguments.length,o=i?arguments[1]:void 0,a=i?arguments[2]:arguments[1];function s(){r.off(e,s),a.apply(this,arguments)}return this.on(e,o,s),this},t.releaseGroup=function(e){var t,n,r,i;for(t in this.callbacks=this.callbacks||{},this.callbacks)for(n=0,r=(i=this.callbacks[t]).length;n<r;n++)i[n]._groupName===e&&(i.splice(n,1),n--,r--);return this},t.off=function(e,t){this.callbacks=this.callbacks||{};var n,r=this.callbacks[e];return r?1===arguments.length?(delete this.callbacks[e],this):(n=r.indexOf(t),r.splice(n,1),0===r.length&&delete this.callbacks[e],this):this},t.emit=function(e){this.callbacks=this.callbacks||{};var t,n,r,i=[].slice.call(arguments,1),o=this.callbacks[e],a=this.getWildcardCallbacks(e);if(o)for(t=0,n=(r=o.slice()).length;t<n&&r[t];++t)r[t].apply(this,i);if(a)for(n=a.length,t=0,n=(r=a.slice()).length;t<n&&r[t];++t)r[t].apply(this,[e].concat(i));return this},t.getWildcardCallbacks=function(e){this.callbacks=this.callbacks||{};var t,n,r=[];for(t in this.callbacks)n=t.split("*"),("*"===t||2===n.length&&e.slice(0,n[0].length)===n[0])&&(r=r.concat(this.callbacks[t]));return r}},r.mixin(r)},{}]},{},[1])(1)},"function"==typeof bootstrap?bootstrap("hark",t):e.exports=t()}}]);